!function(_){"use strict";Object.is||(Object.is=function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}),"function"!=typeof DataTransfer.prototype.setDragImage&&(DataTransfer.prototype.setDragImage=function(e,t,n){});var u="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:this;function p(e,t,n){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){a(i.response,t,n)},i.onerror=function(){console.error("could not download file")},i.send()}function r(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),200<=t.status&&t.status<=299}function s(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(e){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}}var t,n,a=u.saveAs||("object"!=typeof window||window!==u?function(){}:"download"in HTMLAnchorElement.prototype?function(e,t,n){var i=u.URL||u.webkitURL,o=document.createElement("a");t=t||e.name||"download",o.download=t,o.rel="noopener","string"==typeof e?(o.href=e,o.origin!==location.origin?r(o.href)?p(e,t,n):s(o,o.target="_blank"):s(o)):(o.href=i.createObjectURL(e),setTimeout(function(){i.revokeObjectURL(o.href)},4e4),setTimeout(function(){s(o)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,n){if(t=t||e.name||"download","string"==typeof e)if(r(e))p(e,t,n);else{var i=document.createElement("a");i.href=e,i.target="_blank",setTimeout(function(){s(i)})}else navigator.msSaveOrOpenBlob((o=e,void 0===(a=n)?a={autoBom:!1}:"object"!=typeof a&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob([String.fromCharCode(65279),o],{type:o.type}):o),t);var o,a}:function(e,t,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return p(e,t,n);var o="application/octet-stream"===e.type,a=/constructor/i.test(u.HTMLElement)||u.safari,r=/CriOS\/[\d]+/.test(navigator.userAgent);if((r||o&&a)&&"object"==typeof FileReader){var s=new FileReader;s.onloadend=function(){var e=s.result;e=r?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},s.readAsDataURL(e)}else{var l=u.URL||u.webkitURL,c=l.createObjectURL(e);i?i.location=c:location.href=c,i=null,setTimeout(function(){l.revokeObjectURL(c)},4e4)}});u.saveAs=a.saveAs=a,"undefined"!=typeof module&&(module.exports=a),function(e){var t;if("function"==typeof define&&define.amd&&(define(e),t=!0),"object"==typeof exports&&(module.exports=e(),t=!0),!t){var n=window.Cookies,i=window.Cookies=e();i.noConflict=function(){return window.Cookies=n,i}}}(function(){function s(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}function c(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function e(l){function r(){}function n(e,t,n){if("undefined"!=typeof document){"number"==typeof(n=s({path:"/"},r.defaults,n)).expires&&(n.expires=new Date(1*new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var i=JSON.stringify(t);/^[\{\[]/.test(i)&&(t=i)}catch(e){}t=l.write?l.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o="";for(var a in n)n[a]&&(o+="; "+a,!0!==n[a]&&(o+="="+n[a].split(";")[0]));return document.cookie=e+"="+t+o}}function t(e,t){if("undefined"!=typeof document){for(var n={},i=document.cookie?document.cookie.split("; "):[],o=0;o<i.length;o++){var a=i[o].split("="),r=a.slice(1).join("=");t||'"'!==r.charAt(0)||(r=r.slice(1,-1));try{var s=c(a[0]);if(r=(l.read||l)(r,s)||c(r),t)try{r=JSON.parse(r)}catch(e){}if(n[s]=r,e===s)break}catch(e){}}return e?n[e]:n}}return r.set=n,r.get=function(e){return t(e,!1)},r.getJSON=function(e){return t(e,!0)},r.remove=function(e,t){n(e,"",s(t,{expires:-1}))},r.defaults={},r.withConverter=e,r}(function(){})}),_("#vision-app-items").length?_(".vision .vision-toggle").on("click touchend",function(e){e.stopPropagation(),e.preventDefault();var t=_(this),n=t.data("id"),i=null;if(!t.hasClass("vision-locked")){t.addClass("vision-readonly"),i=t.hasClass("vision-checked")?(t.removeClass("vision-checked").addClass("vision-unchecked"),!1):(t.removeClass("vision-unchecked").addClass("vision-checked"),!0);var o=vision_globals.ajax_url,a=vision_globals.ajax_nonce,r=vision_globals.ajax_action_update,s=vision_globals.ajax_msg_error,l={id:n,active:i},c=_.extend(!0,{},l);c=JSON.stringify(c),_.ajax({url:o,type:"POST",dataType:"json",data:{nonce:a,action:r,config:c}}).done(function(e){e&&!e.success&&(i?t.removeClass("vision-checked").addClass("vision-unchecked"):t.removeClass("vision-unchecked").addClass("vision-checked"))}).fail(function(){console.log(s)}).always(function(){t.removeClass("vision-readonly")})}}):_("#vision-app-item").length?(n={alight:null,rootScope:null,wpFileFrameImage:null,wp_base_url:null,wp_upload_url:null,wp_plugin_url:null,wp_ajax_url:null,wp_ajax_nonce:null,wp_ajax_action_update:null,wp_ajax_action_get:null,wp_ajax_action_modal:null,wp_ajax_msg_error:null,wp_item_id:null,themes:null,fonts:null,image:new Image,settings:{themeJavaScript:null,themeCSS:null},config:{active:!0,title:null,image:{relative:!1,url:null},imageWidth:0,imageHeight:0,autoWidth:!0,autoHeight:!0,containerWidth:null,containerHeight:null,theme:"light",class:null,containerId:null,background:{color:null,image:{relative:!1,url:null},size:null,repeat:null,position:null},customCSS:{active:!1,data:null},customJS:{active:!1,data:null},layers:[]},ui:{fullscreen:!1,sidebar:!0,sidebarWidth:400,canvas:{zoomStep:.1,zoom:1,x:0,y:0},moveCanvas:{initX:null,initY:null,lastX:null,lastY:null},sidebarResize:{initX:null,lastX:null,width:null},mapLayers:new Map,activeLayer:null,editLayer:{type:null,initX:null,initY:null,lastX:null,lastY:null,centerX:null,centerY:null,rotation:0,layerAngle:null,layerX:null,layerY:null,layerWidth:null,layerHeight:null},tabs:{general:!0,layers:!1,customCSS:!1,customJS:!1,shortcode:!1},layersTabs:{layers:!0,layer:!1,popover:!1,tooltip:!1},layerTab:{general:!0,data:!0,appearance:!1},tooltipTab:{data:!1,appearance:!0},popoverTab:{data:!1,appearance:!0}},defaultLayer:{type:"link",title:null,x:0,y:0,width:150,height:100,angle:0,lock:!1,visible:!0,responsive:!0,noevents:!1,className:null,url:null,urlNewWindow:!1,userData:null,link:{normalColor:null,hoverColor:null,clickColor:null,radius:0},text:{data:null,font:null,color:"#000",size:18,lineHeight:18,align:null,letterSpacing:null},image:{background:{file:{relative:!1,url:null},color:null,size:"contain",repeat:"no-repeat",position:"50% 50%"}},svg:{file:{url:null,relative:!1}},tooltip:{active:!1,data:null,placement:"top",offset:{x:0,y:0},width:null,widthFromCSS:!1,trigger:"hover",followCursor:!1,responsive:!1,interactive:!0,smart:!1,showOnInit:!1,className:null,showAnimation:null,hideAnimation:null,duration:null},popover:{active:!1,data:null,type:"inbox",placement:"top",offset:{x:0,y:0},width:null,widthFromCSS:!1,responsive:!1,smart:!1,showOnInit:!1,mobileType:"inbox",trigger:"click",className:null}},fn:{init:function(i){i.fn.enableLoading(i);var e,t=_("#vision-app-item");if(t.removeAttr("style"),t.on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",_.proxy(i.fn.onFullScreenChange,this,i)),_(window).on("resize",_.proxy(i.fn.onResize,this,i)),i.plan=vision_globals.plan,i.wp_base_url=vision_globals.wp_base_url,i.wp_upload_url=vision_globals.upload_base_url,i.wp_plugin_url=vision_globals.plugin_base_url,i.wp_ajax_url=vision_globals.ajax_url,i.wp_ajax_nonce=vision_globals.ajax_nonce,i.wp_ajax_action_update=vision_globals.ajax_action_update,i.wp_ajax_action_get=vision_globals.ajax_action_get,i.wp_ajax_action_modal=vision_globals.ajax_action_modal,i.wp_ajax_msg_error=vision_globals.ajax_msg_error,i.msg_pro_title=vision_globals.msg_pro_title,i.msg_edit_text=vision_globals.msg_edit_text,i.msg_custom_js_error=vision_globals.msg_custom_js_error,i.wp_item_id=vision_globals.ajax_item_id,vision_globals.config&&(e=_.extend(!0,{},i.defaultConfig,JSON.parse(vision_globals.config)))){for(var n in e)i.config.hasOwnProperty(n)&&(i.config[n]=e[n]);for(n=0;n<i.config.layers.length;n++){var o=_.extend(!0,{},i.defaultLayer,i.config.layers[n]);o.image.hasOwnProperty("backgroundImage")&&(o.image.background.file.url=o.image.backgroundImage.url,o.image.background.file.relative=o.image.backgroundImage.relative,o.image.background.position=o.image.backgroundPosition,o.image.background.repeat=o.image.backgroundRepeat,o.image.background.size=o.image.backgroundSize,delete o.image.backgroundImage,delete o.image.backgroundPosition,delete o.image.backgroundRepeat,delete o.image.backgroundSize),o.link.hasOwnProperty("url")&&(o.url=o.link.url,o.urlNewWindow=o.link.newWindow,delete o.link.url,delete o.link.newWindow,delete o.link.clickColor),i.config.layers[n]=o}}if(vision_globals.settings&&(e=_.extend(!0,{},JSON.parse(vision_globals.settings))))for(var n in e)i.settings.hasOwnProperty(n)&&(i.settings[n]=e[n]);i.image.onload=function(e){var t=_("#vision-layers-image"),n=this;i.config.imageWidth=n.width,i.config.imageHeight=n.height,t.css({"background-image":"url("+n.src+")",width:n.width,height:n.height}),t.get(0).offsetHeight,i.fn.canvasZoomDefault(i),i.rootScope.scan()},i.image.onerror=function(e){var t=_("#vision-layers-image");i.config.imageWidth=0,i.config.imageHeight=0,t.css({"background-image":"url("+this.src+")",width:0,height:0}),i.fn.canvasZoomFit(i),i.rootScope.scan()},i.rootScope.watch("appData.config.image",function(e){var t=i.fn.getImageUrl(i,e);i.image.src="",i.image.src=t},{deep:2}),i.rootScope.watch("appData.ui.canvas",function(e){_("#vision-layers-canvas").css({transform:"translate3d("+e.x+"px,"+e.y+"px,0) scale("+e.zoom+")"})},{deep:2}),i.rootScope.watch("appData.ui.activeLayer",function(e,t){t&&(_("#wp-vision-tooltip-editor-wrap").hasClass("html-active")?t.tooltip.data=_("#vision-tooltip-editor").val():null!==(n=tinyMCE.get("vision-tooltip-editor"))&&(t.tooltip.data=n.getContent()),_("#wp-vision-popover-editor-wrap").hasClass("html-active")?t.popover.data=_("#vision-popover-editor").val():null!==(n=tinyMCE.get("vision-popover-editor"))&&(t.popover.data=n.getContent()));var n,i=e&&e.tooltip.data?e.tooltip.data:"";_("#wp-vision-tooltip-editor-wrap").hasClass("html-active")?_("#vision-tooltip-editor").val(i):null!==(n=tinyMCE.get("vision-tooltip-editor"))&&n.setContent(i),i=e&&e.popover.data?e.popover.data:"",_("#wp-vision-popover-editor-wrap").hasClass("html-active")?_("#vision-popover-editor").val(i):null!==(n=tinyMCE.get("vision-popover-editor"))&&n.setContent(i)}),i.fn.loadData(i,"fonts").done(function(e){i.fonts=e.list}).always(function(){i.fn.loadData(i,"themes").done(function(e){i.themes=e.list}).always(function(){i.rootScope.scan(),i.fn.disableLoading(i)})})},enableLoading:function(e){_("#vision-app-item").removeClass("vision-active")},disableLoading:function(e){setTimeout(function(){_("#vision-app-item").addClass("vision-active")},1e3)},loadData:function(i,e,t){var o=_.Deferred();return _.ajax({url:i.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:i.wp_ajax_nonce,action:i.wp_ajax_action_get,type:e,id:t},success:function(e){e&&e.success?o.resolve(e.data):this.error()},error:function(e,t,n){i.fn.showNotice(i,i.wp_ajax_msg_error,"notice-error"),o.resolve(null)}}),o.promise()},preview:function(e){e.wp_item_id&&(console.log(e.wp_item_id),window.open(e.wp_base_url+"?vision="+e.wp_item_id,"_blank"))},getPluginConfig:function(t){var e={};e.title=t.config.title,e.imgSrc=t.fn.getImageUrl(t,t.config.image),!t.config.autoWidth&&t.config.containerWidth&&(e.width=t.config.containerWidth),!t.config.autoHeight&&t.config.containerHeight&&(e.height=t.config.containerHeight),e.theme=t.config.theme,e.className=t.config.class,e.flags={customCSS:t.config.customCSS.active,effects:!1};for(var n=[],i=[],o=0;o<t.config.layers.length;o++){var a=t.config.layers[o];a.visible&&(i.push({title:a.title,x:t.config.imageWidth?a.x/(t.config.imageWidth/2)*100:0,y:t.config.imageHeight?a.y/(t.config.imageHeight/2)*100:0,width:a.width,height:a.height,angle:a.angle,responsive:a.responsive,noevents:a.noevents,className:a.className,url:a.url,urlNewWindow:a.urlNewWindow,userData:a.userData,tooltip:{active:a.tooltip.active,trigger:a.tooltip.trigger,placement:a.tooltip.placement,offset:{x:a.tooltip.offset.x,y:a.tooltip.offset.y},width:a.tooltip.width,widthFromCSS:a.tooltip.widthFromCSS,followCursor:a.tooltip.followCursor,responsive:a.tooltip.responsive,interactive:a.tooltip.interactive,smart:a.tooltip.smart,showOnInit:a.tooltip.showOnInit,showAnimation:a.tooltip.showAnimation,hideAnimation:a.tooltip.hideAnimation,duration:a.tooltip.duration,className:a.tooltip.className},popover:{active:a.popover.active,type:a.popover.type,mobileType:a.popover.mobileType,trigger:a.popover.trigger,placement:a.popover.placement,offset:{x:a.popover.offset.x,y:a.popover.offset.y},width:a.popover.width,widthFromCSS:a.popover.widthFromCSS,responsive:a.popover.responsive,smart:a.popover.smart,showOnInit:a.popover.showOnInit,className:a.popover.className}}),"text"==a.type&&a.text.font&&n.push(a.text.font),(a.tooltip.showAnimation||a.tooltip.hideAnimation)&&(e.flags.effects=!0))}if(e.fonts=0<n.length?n:null,e.layers=0<i.length?i:null,t.config.customJS.active){e.onLoad=t.config.customJS.data;try{new Function(e.onLoad)}catch(e){t.fn.showNotice(t,t.msg_custom_js_error+": "+e.message,"notice-error")}}return e},saveConfig:function(t){t.fn.enableLoading(t),t.fn.saveEditorsData(t);var e=_.extend(!0,{},t.config),n=JSON.stringify(e),i=t.fn.getPluginConfig(t),o=JSON.stringify(i);_.ajax({url:t.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:t.wp_ajax_nonce,action:t.wp_ajax_action_update,id:t.wp_item_id,data:n,config:o}}).done(function(e){if(e)return t.wp_item_id=e.data.id,t.fn.showNotice(t,e.data.msg,e.success?"notice-success":"notice-error"),void t.rootScope.scan();t.fn.showNotice(t,t.wp_ajax_msg_error,"notice-error")}).fail(function(){t.fn.showNotice(t,t.wp_ajax_msg_error,"notice-error")}).always(function(){t.fn.disableLoading(t)})},loadConfigFromJson:function(e,t){if(t){var n=JSON.parse(t);e.config=_.extend(!0,{},n),e.rootScope.scan()}},loadConfigFromFile:function(e){var t=_("#vision-load-config-from-file").off("change");t.one("change",_.proxy(function(n,e){var t=e.target.files[0];if(e.target.value="",t){var i=new FileReader;i.onload=_.proxy(function(e){var t=e.target.result;n.fn.loadConfigFromJson(n,t)},this),i.readAsText(t)}},this,e)),t.click()},saveConfigToFile:function(e){var t=_.extend(!0,{},e.config),n=JSON.stringify(t),i=e.wp_item_id?"vision_config_"+e.wp_item_id+".json":"vision_config.json",o=new File([n],i,{type:"application/json;charset=utf-8"});a(o)},showNotice:function(e,t,n){var i=_("#vision-messages"),o=_("<div></div>").addClass("notice is-dismissible").addClass(n),a=_("<p></p>").html(t),r=_("<button></button>").attr("type","button").addClass("notice-dismiss").html('<span class="screen-reader-text">Dismiss this notice.</span>');function s(){clearTimeout(o.data("timer")),o.fadeTo(100,0,function(){o.slideUp(100,function(){o.remove()})})}o.data("timer",setTimeout(s,5e3)),r.click(function(e){e.preventDefault(),s()}),o.append(a,r),i.append(o)},createBlob:function(e,t,n){return new Blob([t],{type:n})},createObjectURL:function(e,t,n){var i=e.fn.createBlob(e,t,n);return URL.createObjectURL(i)},getImageUrl:function(e,t,n){var i="";return t&&t.url&&0<t.url.length&&(i=t.relative?e.wp_upload_url+t.url:t.url,"style"==n&&(i="url("+i+")")),i},selectImage:function(n,i,o){n.wpFileFrameImage&&(n.wpFileFrameImage.detach(),n.wpFileFrameImage=null),n.wpFileFrameImage=wp.media.frames.file_frame=wp.media({library:{type:["image"]},multiple:!1}),n.wpFileFrameImage.on("select",function(e){var t=n.wpFileFrameImage.state().get("selection").first().toJSON().url;-1!==t.indexOf(n.wp_upload_url)?(t=t.replace(n.wp_upload_url,""),o.relative=!0):o.relative=!1,o.url=t,i.scan()}),n.wpFileFrameImage.open()},saveEditorsData:function(e){var t;e.ui.activeLayer&&(_("#wp-vision-tooltip-editor-wrap").hasClass("html-active")?e.ui.activeLayer.tooltip.data=_("#vision-tooltip-editor").val():null!==(t=tinyMCE.get("vision-tooltip-editor"))&&(e.ui.activeLayer.tooltip.data=t.getContent()),_("#wp-vision-popover-editor-wrap").hasClass("html-active")?e.ui.activeLayer.popover.data=_("#vision-popover-editor").val():null!==(t=tinyMCE.get("vision-popover-editor"))&&(e.ui.activeLayer.popover.data=t.getContent()));var n=_("#vision-notepad-css");if(n.length){var i=ace.edit(n.get(0));e.config.customCSS.data=i.getSession().getValue()}var o=_("#vision-notepad-js");if(o.length){var a=ace.edit(o.get(0));e.config.customJS.data=a.getSession().getValue()}},onTab:function(e,t){if(!e.ui.tabs[t]){var n=e.ui.tabs;for(var i in n)n.hasOwnProperty(i)&&(n[i]=!1);switch(e.ui.tabs[t]=!0,e.fn.saveEditorsData(e),e.rootScope.scan(),t){case"general":case"layers":break;case"customCSS":var o=_("#vision-notepad-css"),a=ace.edit(o.get(0));a.$blockScrolling=1/0,a.setTheme("ace/theme/monokai"),a.session.setMode("ace/mode/css"),e.settings.themeCSS&&a.setTheme("ace/theme/"+e.settings.themeCSS),e.config.customCSS.data&&a.getSession().setValue(e.config.customCSS.data);break;case"customJS":var r=_("#vision-notepad-js"),s=ace.edit(r.get(0));s.$blockScrolling=1/0,s.setTheme("ace/theme/monokai"),s.session.setMode("ace/mode/javascript"),e.settings.themeJavaScript&&s.setTheme("ace/theme/"+e.settings.themeJavaScript),e.config.customJS.data&&s.getSession().setValue(e.config.customJS.data)}}},onLayersTab:function(e,t){if(!e.ui.layersTabs[t]){var n=e.ui.layersTabs;for(var i in n)n.hasOwnProperty(i)&&(n[i]=!1);e.ui.layersTabs[t]=!0}},onGeneralTab:function(e,t){e.ui.generalTab[t]=!e.ui.generalTab[t]},onLayerTab:function(e,t){e.ui.layerTab[t]=!e.ui.layerTab[t]},onTooltipTab:function(e,t){e.ui.tooltipTab[t]=!e.ui.tooltipTab[t]},onPopoverTab:function(e,t){e.ui.popoverTab[t]=!e.ui.popoverTab[t]},onResize:function(e,t){},onFullScreenChange:function(e,t){document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?(_("#vision-app-item").addClass("vision-fullscreen"),e.ui.fullscreen=!0):(_("#vision-app-item").removeClass("vision-fullscreen"),e.ui.fullscreen=!1),e.rootScope.scan()},toggleFullscreen:function(e){if(e.ui.fullscreen)try{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){console.error("The browser does not support the fullscreen API")}else try{var t=_("#vision-app-item").get(0);t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}catch(e){console.error("The browser does not support the fullscreen API")}},toggleSidebarPanel:function(e){e.ui.sidebar=!e.ui.sidebar,e.rootScope.scan()},canvasZoomIn:function(e){var t=e.ui.canvas.zoom+e.ui.canvas.zoomStep;t=parseFloat(parseFloat(t).toFixed(2)),e.ui.canvas.zoom=t},canvasZoomOut:function(e){var t=e.ui.canvas.zoom-e.ui.canvas.zoomStep;t=parseFloat(parseFloat(t).toFixed(2)),e.ui.canvas.zoom=t<0?0:t},canvasZoomDefault:function(e){e.ui.canvas.zoom=1},canvasZoomFit:function(e){var t=_("#vision-layers-image"),n=_("#vision-layers-canvas-wrap"),i=t.width()?n.width()/t.width():0,o=t.height()?n.height()/t.height():0,a=1;a=o<i?o:i,e.ui.canvas.zoom=a,e.ui.canvas.x=e.ui.canvas.y=0},canvasMoveDefault:function(e){e.ui.canvas.x=0,e.ui.canvas.y=0},getCanvasZoom:function(e){var t=parseFloat(parseFloat(100*e.ui.canvas.zoom).toFixed(2));return parseInt(t,10)},initLayer:function(e,t,n){e.ui.mapLayers.set(t,_(n))},initLayerInner:function(e,t,n){"text"==t.type&&t.text.data&&_(n).html(t.text.data)},selectLayer:function(e,t){e.ui.activeLayer=t,e.rootScope.scan();var n=e.ui.mapLayers.get(t);n&&n.focus()},isLayerActive:function(e,t){return Object.is(e.ui.activeLayer,t)},onLayerItemClick:function(e,t){e.fn.isLayerActive(e,t)?e.ui.activeLayer=null:e.fn.selectLayer(e,t)},onLayerClick:function(e,t){if(e.fn.isLayerActive(e,t)){var n=e.ui.mapLayers.get(t);n&&n.focus()}else e.fn.selectLayer(e,t)},prevLayer:function(e){if(0!=e.config.layers.length)if(e.ui.activeLayer){for(var t=e.config.layers.length-1;0<t&&!Object.is(e.config.layers[t],e.ui.activeLayer);t--);t=t-1<0?e.config.layers.length-1:t-1,e.fn.selectLayer(e,e.config.layers[t])}else 0<e.config.layers.length&&e.fn.selectLayer(e,e.config.layers[e.config.layers.length-1])},nextLayer:function(e){if(0!=e.config.layers.length)if(e.ui.activeLayer){for(var t=0;t<e.config.layers.length&&!Object.is(e.config.layers[t],e.ui.activeLayer);t++);t=t+1>=e.config.layers.length?0:t+1,e.fn.selectLayer(e,e.config.layers[t])}else 0<e.config.layers.length&&e.fn.selectLayer(e,e.config.layers[0])},addLayerLink:function(e){var t=_.extend(!0,{},e.defaultLayer);t.type="link",e.config.layers.push(t),e.fn.selectLayer(e,t)},addLayerText:function(e){var t=_.extend(!0,{},e.defaultLayer);t.type="text",t.text.data=e.msg_edit_text,e.config.layers.push(t),e.fn.selectLayer(e,t)},addLayerImage:function(e){var t=_.extend(!0,{},e.defaultLayer);t.type="image",e.config.layers.push(t),e.fn.selectLayer(e,t)},addLayerSVG:function(e){var t=_.extend(!0,{},e.defaultLayer);t.type="svg",e.config.layers.push(t),e.fn.selectLayer(e,t)},copyLayer:function(e){if(null!=e.ui.activeLayer){for(var t=null,n=e.config.layers.length,i=null,o=0;o<n;o++)if(i=e.config.layers[o],Object.is(e.ui.activeLayer,i)){t=o;break}null!=t&&((i=_.extend(!0,{},i)).title=(i.title?i.title:i.type)+" [copy]",e.config.layers.splice(t+1,0,i),e.fn.selectLayer(e,i))}},updownLayer:function(e,t){if(null!=e.ui.activeLayer){for(var n=null,i=e.config.layers.length,o=null,a=0;a<i;a++)if(o=e.config.layers[a],Object.is(e.ui.activeLayer,o)){n=a;break}if(null!=n)if("up"==t&&0<n)e.config.layers[n]=e.config.layers[n-1],e.config.layers[n-1]=o,n-=1;else{if(!("down"==t&&n<i-1))return;e.config.layers[n]=e.config.layers[n+1],e.config.layers[n+1]=o,n+=1}}},deleteLayer:function(e){if(null!=e.ui.activeLayer){for(var t=null,n=e.config.layers.length,i=0;i<n;i++){var o=e.config.layers[i];if(Object.is(e.ui.activeLayer,o)){t=i;break}}if(null!=t){var a=t;0<=t&&t<n&&(e.config.layers.splice(t,1),t==n-1&&1<n?a=n-2:1==n&&(a=null)),e.fn.selectLayer(e,e.config.layers[a])}}},editLayerAlign:function(e,t){if(null!=e.ui.activeLayer){var n=e.ui.activeLayer;switch(t){case"top":n.y=-e.config.imageHeight/2+n.height/2;break;case"middle":n.y=0;break;case"bottom":n.y=e.config.imageHeight/2-n.height/2;break;case"left":n.x=-e.config.imageWidth/2+n.width/2;break;case"center":n.x=0;break;case"right":n.x=e.config.imageWidth/2-n.width/2}}},toggleLayerPopover:function(e,t){t.popover.active=!t.popover.active},toggleLayerTooltip:function(e,t){t.tooltip.active=!t.tooltip.active},toggleLayerVisible:function(e,t){t.visible=!t.visible},toggleLayerLock:function(e,t){t.lock=!t.lock},getLayerStyle:function(e,t,n){switch(n){case"x":return t.x-t.width/2+"px";case"y":return t.y-t.height/2+"px";case"width":return t.width+"px";case"height":return t.height+"px";case"angle":return t.angle?"rotate("+t.angle+"deg)":"rotate(0deg)";case"border-radius":return"link"==t.type?t.link.radius?t.link.radius:"":null;case"background-color":return"link"==t.type?t.link.normalColor?t.link.normalColor:"":"image"==t.type?t.image.background.color?t.image.background.color:"":null;case"background-image":return"image"==t.type?e.fn.getImageUrl(e,t.image.background.file,"style"):"svg"==t.type?e.fn.getImageUrl(e,t.svg.file,"style"):null;case"background-size":return"image"==t.type?t.image.background.size?t.image.background.size:"":"svg"==t.type?"100% 100%":null;case"background-repeat":return"image"==t.type?t.image.background.repeat?t.image.background.repeat:"":null;case"background-position":return"image"==t.type?t.image.background.position?t.image.background.position:"":null;case"color":return"text"==t.type?t.text.color:null;case"font-family":if("text"!=t.type)return null;if(t.text.font){var i=t.text.font.replace(new RegExp("[+]|[:]","g"),"");if(0==_("#"+i).length){var o=document.getElementsByTagName("head")[0],a=document.createElement("link");a.setAttribute("id",i),a.setAttribute("rel","stylesheet"),a.setAttribute("href","https://fonts.googleapis.com/css?family="+t.text.font),o.appendChild(a)}return'"'+t.text.font.replace(new RegExp("[+]","g")," ")+'", sans-serif'}return"sans-serif";case"font-size":return"text"==t.type?(0<t.text.size?t.text.size:0)+"px":null;case"line-height":return"text"==t.type?(0<t.text.lineHeight?t.text.lineHeight:0)+"px":null;case"letter-spacing":return"text"==t.type?(0<t.text.letterSpacing?t.text.letterSpacing:0)+"px":null;case"text-align":if("text"==t.type)return t.text.align?t.text.align:""}return null},getLayerCoord:function(e,t,n){switch(n){case"x":return parseFloat(parseFloat(t.x).toFixed(2));case"y":return parseFloat(parseFloat(t.y).toFixed(2));case"angle":return Math.floor(t.angle)}return""},onEditLabelText:function(t,n,e,i){if(!n.lock&&"text"==n.type){var o=t.ui.mapLayers.get(n),a=_(e);o.addClass("vision-editing"),a.attr("contenteditable",!0).focus(),a.on("input",r),a.one("blur",function(e){o.removeClass("vision-editing"),a.attr("contenteditable",!1),a.off("input",r)})}function r(e){n.text.data=a.html(),""==n.text.data.replace("<br>","").trim()&&(n.text.data=t.msg_edit_text,a.html(n.text.data))}},onEditLayerKeyDown:function(e,t,n){var i=e.ui.mapLayers.get(t);if(!t.lock&&!i.hasClass("vision-editing")){var o=!1;switch(n.which){case 37:t.x-=1,o=!0;break;case 38:t.y-=1,o=!0;break;case 39:t.x+=1,o=!0;break;case 40:t.y+=1,o=!0}o&&(n.preventDefault(),n.stopPropagation(),e.rootScope.scan())}},onEditLayerStart:function(e,t,n,i){var o=e.ui.mapLayers.get(t);t.lock||o.hasClass("vision-editing")||(e.fn.onLayerClick(e,t),e.ui.editLayer.type=n,e.ui.editLayer.initX=i.pageX,e.ui.editLayer.initY=i.pageY,e.ui.editLayer.lastX=i.pageX,e.ui.editLayer.lastY=i.pageY,e.ui.editLayer.centerX=o.offset().left+o.width()/2,e.ui.editLayer.centerY=o.offset().top+o.height()/2,e.ui.editLayer.rotation=Math.atan2(i.pageY-e.ui.editLayer.centerY,i.pageX-e.ui.editLayer.centerX),e.ui.editLayer.layerAngle=t.angle,e.ui.editLayer.layerX=t.x,e.ui.editLayer.layerY=t.y,e.ui.editLayer.layerWidth=t.width,e.ui.editLayer.layerHeight=t.height,i.preventDefault(),i.stopPropagation(),_("body").on("mousemove",_.proxy(e.fn.onEditLayerMove,this,e,t)),_("body").on("mouseup",_.proxy(e.fn.onEditLayerEnd,this,e,t)),_("body").on("mouseleave",_.proxy(e.fn.onEditLayerEnd,this,e,t)))},onEditLayerMove:function(n,i,o){o.preventDefault(),o.stopPropagation();var e,t,a,r=n.ui.canvas.zoom;function s(){var e=o.pageX-n.ui.editLayer.initX,t=n.ui.editLayer.layerWidth-2*e/r;i.width=t<=0?0:t,n.rootScope.scan()}function l(){var e=o.pageY-n.ui.editLayer.initY,t=n.ui.editLayer.layerHeight-2*e/r;i.height=t<=0?0:t,n.rootScope.scan()}function c(){var e=o.pageX-n.ui.editLayer.initX,t=n.ui.editLayer.layerWidth+2*e/r;i.width=t<=0?0:t,n.rootScope.scan()}function u(){var e=o.pageY-n.ui.editLayer.initY,t=n.ui.editLayer.layerHeight+2*e/r;i.height=t<=0?0:t,n.rootScope.scan()}switch(n.ui.editLayer.type){case"drag":t=o.pageX-n.ui.editLayer.lastX,a=o.pageY-n.ui.editLayer.lastY,n.ui.editLayer.lastX=o.pageX,n.ui.editLayer.lastY=o.pageY,i.x=i.x+t/r,i.y=i.y+a/r,n.rootScope.scan();break;case"rotate":e=(Math.atan2(o.pageY-n.ui.editLayer.centerY,o.pageX-n.ui.editLayer.centerX)-n.ui.editLayer.rotation)*(180/Math.PI),i.angle=n.ui.editLayer.layerAngle+e,i.angle<0?i.angle=360+i.angle:360<=i.angle&&(i.angle=i.angle-360),n.rootScope.scan();break;case"tl":l(),s();break;case"tm":l();break;case"tr":l(),c();break;case"rm":c();break;case"br":u(),c();break;case"bm":u();break;case"bl":u(),s();break;case"lm":s()}},onEditLayerEnd:function(e,t,n){n.preventDefault(),n.stopPropagation(),_("body").off("mousemove",_.proxy(e.fn.onEditLayerMove,this,e,t)),_("body").off("mouseup",_.proxy(e.fn.onEditLayerEnd,this,e,t)),_("body").off("mouseleave",_.proxy(e.fn.onEditLayerEnd,this,e,t)),e.ui.editLayer.type=null,e.ui.editLayer.initX=null,e.ui.editLayer.initY=null,e.ui.editLayer.lastX=null,e.ui.editLayer.lastY=null,e.ui.editLayer.centerX=null,e.ui.editLayer.centerY=null,e.ui.editLayer.rotation=0,e.ui.editLayer.layerAngle=null,e.ui.editLayer.layerX=null,e.ui.editLayer.layerY=null,e.ui.editLayer.layerWidth=null,e.ui.editLayer.layerHeight=null},onMoveCanvasStart:function(e,t){t.preventDefault(),t.stopPropagation(),e.ui.moveCanvas.initX=t.pageX,e.ui.moveCanvas.initY=t.pageY,e.ui.moveCanvas.lastX=t.pageX,e.ui.moveCanvas.lastY=t.pageY,_("body").on("mousemove",_.proxy(e.fn.onMoveCanvas,this,e)),_("body").on("mouseup",_.proxy(e.fn.onMoveCanvasEnd,this,e)),_("body").on("mouseleave",_.proxy(e.fn.onMoveCanvasEnd,this,e))},onMoveCanvas:function(e,t){t.preventDefault(),t.stopPropagation();var n=t.pageX-e.ui.moveCanvas.lastX,i=t.pageY-e.ui.moveCanvas.lastY;e.ui.moveCanvas.lastX=t.pageX,e.ui.moveCanvas.lastY=t.pageY,e.ui.canvas.x+=n,e.ui.canvas.y+=i,e.rootScope.scan()},onMoveCanvasEnd:function(e,t){t.preventDefault(),t.stopPropagation(),_("body").off("mousemove",_.proxy(e.fn.onMoveCanvas,this,e)),_("body").off("mouseup",_.proxy(e.fn.onMoveCanvasEnd,this,e)),_("body").off("mouseleave",_.proxy(e.fn.onMoveCanvasEnd,this,e)),e.ui.moveCanvas.initX=null,e.ui.moveCanvas.initY=null,e.ui.moveCanvas.lastX=null,e.ui.moveCanvas.lastY=null},onSidebarResizeStart:function(e,t){t.preventDefault(),t.stopPropagation(),e.ui.sidebarResize.initX=t.pageX,e.ui.sidebarResize.lastX=t.pageX,e.ui.sidebarResize.width=e.ui.sidebarWidth,_("body").on("mousemove",_.proxy(e.fn.onSidebarResize,this,e)),_("body").on("mouseup",_.proxy(e.fn.onSidebarResizeEnd,this,e)),_("body").on("mouseleave",_.proxy(e.fn.onSidebarResizeEnd,this,e))},onSidebarResize:function(e,t){t.preventDefault(),t.stopPropagation();var n=t.pageX-e.ui.sidebarResize.lastX;e.ui.sidebarResize.lastX=t.pageX,e.ui.sidebarResize.width-=n,400<=e.ui.sidebarResize.width&&e.ui.sidebarResize.width<=800&&(e.ui.sidebarWidth=e.ui.sidebarResize.width,e.rootScope.scan())},onSidebarResizeEnd:function(e,t){t.preventDefault(),t.stopPropagation(),_("body").off("mousemove",_.proxy(e.fn.onSidebarResize,this,e)),_("body").off("mouseup",_.proxy(e.fn.onSidebarResizeEnd,this,e)),_("body").off("mouseleave",_.proxy(e.fn.onSidebarResizeEnd,this,e)),e.ui.sidebarResize.initX=null,e.ui.sidebarResize.lastX=null,e.ui.sidebarResize.width=null},selectShowAnimation:function(t,n){var i={selectedClass:null};console.log(n),t.modal.fn.show(t,"show-effects",i,t.fn.selectAnimationCallback).then(function(e){t.modal.fn.close(t,i.id),"close"!=e&&e&&(n.showAnimation=i.selectedClass,t.rootScope.scan())})},selectHideAnimation:function(t,n){var i={selectedClass:null};t.modal.fn.show(t,"hide-effects",i,t.fn.selectAnimationCallback).then(function(e){t.modal.fn.close(t,i.id),"close"!=e&&e&&(n.hideAnimation=i.selectedClass,t.rootScope.scan())})},selectAnimationCallback:function(i){_("#vision-modal-"+i.id).find(".vision-modal-btn[data-fx-name]").on("click",function(e){var t=_(this),n=t.data("fx-name");t.removeClass(n).addClass(n),i.selectedClass=n,i.rootScope.scan()}),_("#vision-modal-"+i.id).find(".vision-modal-btn[data-fx-name]").on("dblclick",function(e){var t=_(this).data("fx-name");i.selectedClass=t,i.deferred.resolve(!0)}),_("#vision-modal-"+i.id).find(".vision-modal-btn[data-fx-name]").on(function(){var e=document.createElement("fakeelement"),t={animation:"animationend",MSAnimationEnd:"msAnimationEnd",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var n in t)if(void 0!==e.style[n])return t[n]}(),function(e){var t=_(this),n=t.data("fx-name");t.hasClass(n)&&t.removeClass(n)})},floor:function(e,t){return Math.floor(t)},assignObject:function(e,t,n){for(var i in t)n.hasOwnProperty(i)&&(n[i]=t[i])},copyToClipboard:function(e,t){var n=_(t);if(0!=n.length){var i=n.val();if(window.clipboardData&&window.clipboardData.setData)return clipboardData.setData("Text",i);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var o=document.createElement("textarea");o.textContent=i,o.style.position="fixed",document.body.appendChild(o),o.select();try{document.execCommand("copy")}catch(e){console.warn("Copy to clipboard failed.",e)}finally{document.body.removeChild(o)}}n.select()}}},modal:{count:0,items:[],fn:{show:function(i,e,o,t){var a=++i.modal.count,r=_.Deferred();return i.modal.items.push(a),i.inprocess++,_.ajax({url:i.wp_ajax_url,type:"GET",dataType:"html",data:{nonce:i.wp_ajax_nonce,action:i.wp_ajax_action_modal,name:e}}).done(function(e){console.log(e),_("body").addClass("vision-modal-open");var t=_(e),n={};n.modalData=o,n.modalData.id=a,n.modalData.deferred=r,n.modalData.appData=i,(null==o.easyClose||o.easyClose)&&t.on("click",function(e){n.modalData.deferred.resolve("close")}),t.find(".vision-modal-dialog").on("click",function(e){return!1}),_("#vision-modals").append(t),o.rootScope=i.alight(t.get(0),n)}).fail(function(e,t,n){i.fn.showNotice(i,i.wp_ajax_msg_error,"notice-error")}).always(function(){t&&"function"==typeof t&&t.call(this,o),i.inprocess--}),r.promise()},close:function(e,t){_("#vision-modal-"+t).remove();var n=e.modal.items.indexOf(t);e.modal.items.splice(n,1),0==e.modal.items.length&&jQuery("body").removeClass("vision-modal-open")}}}},window.alightInitCallback=function(e){delete window.alightInitCallback,e.directives.al.text={restrict:"EA",link:function(i,e,o,a){var r=_(e),s=_(e);s.on("input change",function(e){var t,n=s.val();(!(t=n)||/^\s*$/.test(t))&&(n=null),a.setValue(o,n),a.scan(),function(){var e=r.data("callback");if(e){var t=a.changeDetector.compile(e);t(i)}}()}),a.watch(o,function(e){null==e?s.val(null):s.val(e)},{readOnly:!0})}},e.directives.al.textarea={restrict:"EA",link:function(i,e,o,a){var r=_(e),s=_(e);r.addClass("vision-textarea"),s.on("input change",function(e){var t,n=s.val();(!(t=n)||/^\s*$/.test(t))&&(n=null),a.setValue(o,n),a.scan(),function(){var e=r.data("callback");if(e){var t=a.changeDetector.compile(e);t(i)}}()}),a.watch(o,function(e){null==e?s.val(null):s.val(e)},{readOnly:!0})}},e.directives.al.integer={restrict:"EA",link:function(o,e,a,r){var s=_(e),l=_(e);l.on("input change",function(e){var t,n=l.val(),i=!0;!(t=n)||/^\s*$/.test(t)?n=null:n.match("^([+-]?[1-9]+[0-9]*|0)$")?n=parseInt(n,10):i=!1,i?(r.setValue(a,n),r.scan(),function(){var e=s.data("callback");if(e){var t=r.changeDetector.compile(e);t(o)}}(),s.removeClass("vision-invalid")):s.addClass("vision-invalid")}),r.watch(a,function(e){s.removeClass("vision-invalid"),null==e?l.val(null):l.val(e)},{readOnly:!0})}},e.directives.al.float={restrict:"EA",link:function(o,e,a,r){var s=_(e),l=_(e);l.on("input change",function(e){var t,n=l.val(),i=!0;!(t=n)||/^\s*$/.test(t)?n=null:n.match("^[+-]?([0-9]+([.][0-9]*)?|[.][0-9]+)$")?n=parseFloat(n):i=!1,i?(r.setValue(a,n),r.scan(),function(){var e=s.data("callback");if(e){var t=r.changeDetector.compile(e);t(o)}}(),s.removeClass("vision-invalid")):s.addClass("vision-invalid")}),r.watch(a,function(e){s.removeClass("vision-invalid"),null==e?l.val(null):l.val(e)},{readOnly:!0})}},e.directives.al.toggle={restrict:"EA",link:function(n,e,t,i){var o=_(e);o.addClass("vision-toggle").html("&nbsp;"),o.on("mousedown touchstart",function(e){i.setValue(t,!i.getValue(t)),i.scan(),function(){var e=o.data("callback");if(e){var t=i.changeDetector.compile(e);t(n)}}()}),i.watch(t,function(e){e?o.addClass("vision-checked").removeClass("vision-unchecked"):o.removeClass("vision-checked").addClass("vision-unchecked")},{readOnly:!0})}},e.directives.al.checkbox={restrict:"EA",link:function(n,e,t,i){var o=_(e);o.addClass("vision-checkbox").html('<i class="vision-icon vision-icon-check"></i>'),o.on("mousedown touchstart",function(e){i.setValue(t,!i.getValue(t)),i.scan(),function(){var e=o.data("callback");if(e){var t=i.changeDetector.compile(e);t(n)}}()}),i.watch(t,function(e){e?o.addClass("vision-checked").removeClass("vision-unchecked"):o.removeClass("vision-checked").addClass("vision-unchecked")},{readOnly:!0})}},e.directives.al.unit={restrict:"EA",link:function(t,e,o,a){var n=_(e),r=_("<input/>").addClass("vision-unit-value"),s=_("<select/>").addClass("vision-unit-type");function l(){var e=n.data("callback");e&&a.changeDetector.compile(e)(t)}s.append('<option value="px">px</li>'),s.append('<option value="%">%</li>'),s.append('<option value="em">em</li>'),s.append('<option value="cm">cm</li>'),s.append('<option value="mm">mm</li>'),s.append('<option value="in">in</li>'),s.append('<option value="pt">pt</li>'),s.append('<option value="pc">pc</li>'),s.append('<option value="ex">ex</li>'),s.append('<option value="ch">ch</li>'),s.append('<option value="rem">rem</li>'),s.append('<option value="vw">vw</li>'),s.append('<option value="vh">vh</li>'),s.append('<option value="vmin">vmin</li>'),s.append('<option value="vmax">vmax</li>'),n.append(r,s),r.on("input change",function(e){var t,n=r.val(),i=!0;!(t=n)||/^\s*$/.test(t)?n={value:null,type:s.val()}:n.match("^[+-]?([0-9]+([.][0-9]*)?|[.][0-9]+)$")?n={value:parseFloat(n),type:s.val()}:i=!1,i?(a.setValue(o,n),a.scan(),l(),r.removeClass("vision-invalid")):r.addClass("vision-invalid")}),s.on("change",function(e){var t=s.val(),n=a.getValue(o);n&&(n.type=t,a.setValue(o,n),a.scan(),l())}),a.watch(o,function(e){r.removeClass("vision-invalid"),null==e?(r.val(null),s.val("px")):(r.val(e.value),s.val(e.type))},{readOnly:!0})}},e.directives.al.style={restrict:"EA",link:function(e,t,n,i){if(i.attrArgument){var o=_(t),a=i.attrArgument.split(".")[0];i.watch(n,function(e){o.css(a,e)},{readOnly:!0})}}},e.directives.al.backgroundrepeat={restrict:"EA",link:function(e,t,n,i){var o=_(t),a=_("<select/>").addClass(o.get(0).className);a.append('<option value="none">none</option>'),a.append('<option value="repeat">repeat</option>'),a.append('<option value="repeat-x">repeat-x</option>'),a.append('<option value="repeat-y">repeat-y</option>'),a.append('<option value="no-repeat">no-repeat</option>'),o.append(a),a.unwrap(),a.on("change",function(e){var t=a.val();"none"==t&&(t=null),i.setValue(n,t),i.scan()}),i.watch(n,function(e){null==e?a.val("none"):a.val(e)},{readOnly:!0})}},e.directives.al.backgroundsize={restrict:"EA",link:function(e,t,n,i){var o=_(t),a=_("<select/>").addClass(o.get(0).className);a.append('<option value="none">none</option>'),a.append('<option value="auto">auto</option>'),a.append('<option value="cover">cover</option>'),a.append('<option value="contain">contain</option>'),a.append('<option value="100% 100%">stretch</option>'),o.append(a),a.unwrap(),a.on("change",function(e){var t=a.val();"none"==t&&(t=null),i.setValue(n,t),i.scan()}),i.watch(n,function(e){null==e?a.val("none"):a.val(e)},{readOnly:!0})}},e.directives.al.textfont={restrict:"EA",link:function(e,t,n,i){for(var o=_(t),a=_("<select/>").addClass(o.get(0).className),r=i.getValue(o.data("fonts")),s=0;s<r.length;s++){var l=r[s].fontname.replace(new RegExp("[+]","g")," "),c=r[s].fontname;a.append('<option value="'+c+'">'+l+"</option>")}o.append(a),a.unwrap(),a.on("change",function(e){var t=a.val();"none"==t&&(t=null),i.setValue(n,t),i.scan()}),i.watch(n,function(e){null==e?a.val("none"):a.val(e)},{readOnly:!0})}},e.directives.al.textalign={restrict:"EA",link:function(e,t,n,i){var o=_(t),a=_("<select/>").addClass(o.get(0).className);a.append('<option value="none">none</option>'),a.append('<option value="left">left</option>'),a.append('<option value="right">right</option>'),a.append('<option value="center">center</option>'),a.append('<option value="justify">justify</option>'),o.append(a),a.unwrap(),a.on("change",function(e){var t=a.val();"none"==t&&(t=null),i.setValue(n,t),i.scan()}),i.watch(n,function(e){null==e?a.val("none"):a.val(e)},{readOnly:!0})}},e.directives.al.color={restrict:"EA",link:function(t,a,r,s){var n=_(a),i=_("<div></div>").addClass("vision-color-btn").append("<div><div></div></div>"),o=_("<input/>").addClass("vision-color-value");n.append(i,o),i.on("click touchend",function(e){u.show(i,s.getValue(r))}),o.on("input change",function(e){var t,n=_(this).val(),i=!0;if(!(t=n)||/^\s*$/.test(t))n=null;else{var o=new c;o.setColor(n)||(i=!1)}i?(s.setValue(r,n),s.scan(),p(),_(a).removeClass("vision-invalid")):_(a).addClass("vision-invalid")});var l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}}];function c(){this.rgb={r:0,g:0,b:0},this.hsb={h:0,s:0,b:0},this.alpha=1}function e(e){this.config=null,this.color=new c,this.controls={},this.inputEdit={enabled:!1,pageY:0,value:0,type:null},this._init(e)}c.prototype={rgb:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},rgba:function(){return"rgba("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+","+this.alpha+")"},hex:function(){return this.toHex()},RGBAtoHSBA:function(e,t,n,i){var o=0,a=Math.max(e,t,n),r=a-Math.min(e,t,n),s=a/255,l=0!=a?r/a:0;if(l){var c=(a-e)/r,u=(a-t)/r,p=(a-n)/r;o=e==a?p-u:t==a?2+c-p:4+u-c,(o/=6)<0&&o++}return{h:Math.round(360*o),s:Math.round(100*l),b:Math.round(100*s),a:i||1}},HSBAtoRGBA:function(e,t,n,i){var o,a,r,s,l;return e=(e=e)%360/60,o=a=r=(n/=100)-(l=n*(t/=100)),o+=[l,s=l*(1-Math.abs(e%2-1)),0,0,s,l][e=~~e],a+=[s,l,l,s,0,0][e],r+=[0,0,s,l,l,s][e],{r:Math.round(255*o),g:Math.round(255*a),b:Math.round(255*r),a:i||1}},setColor:function(e){for(var t in e=e.toLowerCase(),l)if(l.hasOwnProperty(t)){var n=l[t],i=n.re.exec(e),o=i&&n.parse(i);if(o){var a=this.RGBAtoHSBA.apply(null,o);return this.hsb={h:a.h,s:a.s,b:a.b},this.rgb={r:o[0],g:o[1],b:o[2]},this.alpha=a.a,!0}}return!1},setRed:function(e){255<e?e=255:e<0&&(e=0),this.rgb.r=e;var t=this.RGBAtoHSBA(this.rgb.r,this.rgb.g,this.rgb.b);this.hsb={h:t.h,s:t.s,b:t.b}},setGreen:function(e){255<e?e=255:e<0&&(e=0),this.rgb.g=e;var t=this.RGBAtoHSBA(this.rgb.r,this.rgb.g,this.rgb.b);this.hsb={h:t.h,s:t.s,b:t.b}},setBlue:function(e){255<e?e=255:e<0&&(e=0),this.rgb.b=e;var t=this.RGBAtoHSBA(this.rgb.r,this.rgb.g,this.rgb.b);this.hsb={h:t.h,s:t.s,b:t.b}},setHue:function(e){360<e?e=360:e<0&&(e=0),this.hsb.h=e;var t=this.HSBAtoRGBA(this.hsb.h,this.hsb.s,this.hsb.b);this.rgb={r:t.r,g:t.g,b:t.b}},setSaturation:function(e){100<e?e=100:e<0&&(e=0),this.hsb.s=e;var t=this.HSBAtoRGBA(this.hsb.h,this.hsb.s,this.hsb.b);this.rgb={r:t.r,g:t.g,b:t.b}},setBrightness:function(e){100<e?e=100:e<0&&(e=0),this.hsb.b=e;var t=this.HSBAtoRGBA(this.hsb.h,this.hsb.s,this.hsb.b);this.rgb={r:t.r,g:t.g,b:t.b}},setAlpha:function(e){1<(e=parseInt(100*e,10)/100)?e=1:e<0&&(e=0),this.alpha=e},toRGBA:function(){return{r:this.rgb.r,g:this.rgb.g,b:this.rgb.b,a:this.alpha}},toHSBA:function(){return{h:this.hsb.h,s:this.hsb.s,b:this.hsb.b,a:this.alpha}},toHex:function(){return"#"+(1<<24|parseInt(this.rgb.r,10)<<16|parseInt(this.rgb.g,10)<<8|parseInt(this.rgb.b,10)).toString(16).substr(1)}},e.prototype={defaults:{onSelect:null},_init:function(e){this.config=_.extend(!0,{},this.defaults,e),this._create()},_create:function(){this._buildDOM(),this._bind(),this._refresh()},_buildDOM:function(){var e=_("<div></div>").addClass("vision-data"),t=_("<div></div>").addClass("vision-color-picker"),n=_("<div></div>").addClass("vision-thumb"),i=_("<div></div>").addClass("vision-pallete").append(n),o=_("<div></div>").addClass("vision-thumb"),a=_("<div></div>").addClass("vision-hue").append(o),r=_("<div></div>").addClass("vision-panel"),s=_("<div></div>").addClass("vision-input").append('<span>R<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>'),l=_("<div></div>").addClass("vision-input").append('<span>G<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>'),c=_("<div></div>").addClass("vision-input").append('<span>B<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>'),u=_("<div></div>").addClass("vision-line"),p=_("<div></div>").addClass("vision-input").append('<span>H<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>'),d=_("<div></div>").addClass("vision-input").append('<span>S<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>'),f=_("<div></div>").addClass("vision-input").append('<span>B<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>');r.append(s,l,c,u,p,d,f),t.append(e.append(i,a,r)),this.controls.$picker=t,this.controls.$pallete=i,this.controls.$pallete_thumb=n,this.controls.$hue=a,this.controls.$hue_thumb=o,this.controls.$input_rgb_r=s.find("input"),this.controls.$input_rgb_g=l.find("input"),this.controls.$input_rgb_b=c.find("input"),this.controls.$input_hsb_h=p.find("input"),this.controls.$input_hsb_s=d.find("input"),this.controls.$input_hsb_b=f.find("input"),this.controls.$input_rgb_r_thumb=s.find(".vision-thumb"),this.controls.$input_rgb_g_thumb=l.find(".vision-thumb"),this.controls.$input_rgb_b_thumb=c.find(".vision-thumb"),this.controls.$input_hsb_h_thumb=p.find(".vision-thumb"),this.controls.$input_hsb_s_thumb=d.find(".vision-thumb"),this.controls.$input_hsb_b_thumb=f.find(".vision-thumb"),e=_("<div></div>").addClass("vision-data");var h=_("<div></div>").addClass("vision-thumb"),v=_("<div></div>").addClass("vision-gradient"),m=_("<div></div>").addClass("vision-alpha").append(v,h),g=(r=_("<div></div>").addClass("vision-panel"),_("<div></div>").addClass("vision-input").append('<span>A<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>'));r.append(g),t.append(e.append(m,r)),this.controls.$alpha=m,this.controls.$alpha_thumb=h,this.controls.$alpha_gradient=v,this.controls.$input_alpha=g.find("input"),this.controls.$input_alpha_thumb=g.find(".vision-thumb"),e=_("<div></div>").addClass("vision-data");var b=_("<div></div>").addClass("vision-preview").append("<div><div></div></div>"),y=_("<input readonly />").addClass("vision-input-color"),w=_("<div></div>").addClass("vision-submit").text("OK");t.append(e.append(b,y,w)),this.controls.$preview=b.find("> div > div"),this.controls.$input_color=y,this.controls.$submit=w,t.appendTo("body")},_bind:function(){this.controls.$pallete.on("mousedown",_.proxy(this._onPalleteEditStart,this)),this.controls.$pallete.on("click",_.proxy(this._onPalleteEditMove,this)),this.controls.$hue.on("mousedown",_.proxy(this._onHueEditStart,this)),this.controls.$hue.on("click",_.proxy(this._onHueEditMove,this)),this.controls.$alpha.on("mousedown",_.proxy(this._onAlphaEditStart,this)),this.controls.$alpha.on("click",_.proxy(this._onAlphaEditMove,this)),this.controls.$input_rgb_r_thumb.on("mousedown",_.proxy(this._onInputEditStart,this,"rgb_r")),this.controls.$input_rgb_g_thumb.on("mousedown",_.proxy(this._onInputEditStart,this,"rgb_g")),this.controls.$input_rgb_b_thumb.on("mousedown",_.proxy(this._onInputEditStart,this,"rgb_b")),this.controls.$input_hsb_h_thumb.on("mousedown",_.proxy(this._onInputEditStart,this,"hsb_h")),this.controls.$input_hsb_s_thumb.on("mousedown",_.proxy(this._onInputEditStart,this,"hsb_s")),this.controls.$input_hsb_b_thumb.on("mousedown",_.proxy(this._onInputEditStart,this,"hsb_b")),this.controls.$input_alpha_thumb.on("mousedown",_.proxy(this._onInputEditStart,this,"alpha")),this.controls.$input_rgb_r.on("input",_.proxy(this._onInput,this,"rgb_r")),this.controls.$input_rgb_g.on("input",_.proxy(this._onInput,this,"rgb_g")),this.controls.$input_rgb_b.on("input",_.proxy(this._onInput,this,"rgb_b")),this.controls.$input_hsb_h.on("input",_.proxy(this._onInput,this,"hsb_h")),this.controls.$input_hsb_s.on("input",_.proxy(this._onInput,this,"hsb_s")),this.controls.$input_hsb_b.on("input",_.proxy(this._onInput,this,"hsb_b")),this.controls.$input_alpha.on("input",_.proxy(this._onInput,this,"alpha")),this.controls.$submit.on("click",_.proxy(this._onSubmit,this))},_refresh:function(){var e=this.color.toRGBA(),t=this.color.toHSBA(),n=this.controls.$pallete.outerHeight()-2,i=this.controls.$pallete.outerWidth()-2;this.controls.$pallete.css({"background-color":"hsl("+t.h+", 100%, 50%)"}),this.controls.$pallete_thumb.css({top:parseInt(n-n*t.b/100,10)}),this.controls.$pallete_thumb.css({left:parseInt(i-i*(100-t.s)/100,10)}),n=this.controls.$hue.outerHeight()-2,this.controls.$hue_thumb.css({top:parseInt(n-n*t.h/360,10)}),i=this.controls.$alpha.outerWidth()-2,this.controls.$alpha_thumb.css({left:parseInt(i-i*(1-t.a),10)}),this.controls.$alpha_gradient.css({background:"linear-gradient(to left,"+this.color.hex()+",rgba(0,0,0,0))"}),this.controls.$input_rgb_r.val(e.r),this.controls.$input_rgb_g.val(e.g),this.controls.$input_rgb_b.val(e.b),this.controls.$input_hsb_h.val(t.h),this.controls.$input_hsb_s.val(t.s),this.controls.$input_hsb_b.val(t.b),this.controls.$input_alpha.val(parseInt(100*e.a,10)),this.controls.$preview.css({"background-color":this.color.rgba()}),this.controls.$input_color.val(1!=e.a?this.color.rgba():this.color.hex())},_show:function(e){var t=e.offset(),n=e.outerWidth(),i=e.outerHeight(),o=this.controls.$picker.outerWidth(),a=this.controls.$picker.outerHeight(),r=t.top-a-1,s=t.left;this.controls.$picker.offset({top:r,left:s});var l=this.controls.$picker.get(0).getBoundingClientRect();l.y<0&&(r=t.top+i+offsetH+1,this.controls.$picker.offset({top:r})),l.x+l.width>window.innerWidth&&(s=t.left+n-o,this.controls.$picker.offset({left:s})),this.controls.$picker.addClass("vision-active"),_("body").on("mousedown touchstart",_.proxy(this._onBodyClick,this))},_hide:function(){this.controls.$picker.removeClass("vision-active").css({top:"",left:""}),_("body").off("mousedown touchstart",_.proxy(this._onBodyClick,this))},_destroy:function(){this.controls.$picker&&this.controls.$picker.remove(),this.config=null,this.color=new c,this.controls={}},_onPalleteEditStart:function(e){_("body").on("mouseup",_.proxy(this._onPalleteEditEnd,this)),_("body").on("mousemove",_.proxy(this._onPalleteEditMove,this))},_onPalleteEditMove:function(e){var t=this.controls.$pallete.outerHeight(),n=this.controls.$pallete.outerWidth(),i=100-parseInt(100*(n-Math.max(0,Math.min(n,e.pageX-this.controls.$pallete.offset().left)))/n,10),o=parseInt(100*(t-Math.max(0,Math.min(t,e.pageY-this.controls.$pallete.offset().top)))/t,10);return this.color.setSaturation(i),this.color.setBrightness(o),this._refresh(),!1},_onPalleteEditEnd:function(e){return _("body").off("mouseup",_.proxy(this._onPalleteEditEnd,this)),_("body").off("mousemove",_.proxy(this._onPalleteEditMove,this)),this._refresh(),!1},_onHueEditStart:function(e){_("body").on("mouseup",_.proxy(this._onHueEditEnd,this)),_("body").on("mousemove",_.proxy(this._onHueEditMove,this))},_onHueEditMove:function(e){var t=this.controls.$hue.outerHeight(),n=parseInt(360*(t-Math.max(0,Math.min(t,e.pageY-this.controls.$hue.offset().top)))/t,10);return this.color.setHue(n),this._refresh(),!1},_onHueEditEnd:function(e){return _("body").off("mouseup",_.proxy(this._onHueEditEnd,this)),_("body").off("mousemove",_.proxy(this._onHueEditMove,this)),this._refresh(),!1},_onAlphaEditStart:function(e){_("body").on("mouseup",_.proxy(this._onAlphaEditEnd,this)),_("body").on("mousemove",_.proxy(this._onAlphaEditMove,this))},_onAlphaEditMove:function(e){var t=this.controls.$alpha.outerWidth(),n=1-(t-Math.max(0,Math.min(t,e.pageX-this.controls.$alpha.offset().left)))/t;return this.color.setAlpha(n),this._refresh(),!1},_onAlphaEditEnd:function(e){return _("body").off("mouseup",_.proxy(this._onAlphaEditEnd,this)),_("body").off("mousemove",_.proxy(this._onAlphaEditMove,this)),this._refresh(),!1},_onInputEditStart:function(e,t){_("body").on("mouseup",_.proxy(this._onInputEditEnd,this)),_("body").on("mousemove",_.proxy(this._onInputEditMove,this)),this.inputEdit.enabled=!0,this.inputEdit.pageY=t.pageY,this.inputEdit.value=parseInt(_(t.target).siblings("input").val(),10),this.inputEdit.type=e},_onInputEditMove:function(e){if(this.inputEdit.enabled){var t=e.pageY-this.inputEdit.pageY,n=this.inputEdit.value+t;switch(this.inputEdit.type){case"rgb_r":this.color.setRed(n);break;case"rgb_g":this.color.setGreen(n);break;case"rgb_b":this.color.setBlue(n);break;case"hsb_h":this.color.setHue(n);break;case"hsb_s":this.color.setSaturation(n);break;case"hsb_b":this.color.setBrightness(n);break;case"alpha":this.color.setAlpha(n/100)}}return this._refresh(),!1},_onInputEditEnd:function(e){return _("body").off("mouseup",_.proxy(this._onInputEditEnd,this)),_("body").off("mousemove",_.proxy(this._onInputEditMove,this)),this.inputEdit.enabled=!1,this.inputEdit.pageY=0,this.inputEdit.value=0,this.inputEdit.type=null,this._refresh(),!1},_onInput:function(e,t){var n=_(t.target).val();switch(n=parseInt(n,10)||0,e){case"rgb_r":this.color.setRed(n);break;case"rgb_g":this.color.setGreen(n);break;case"rgb_b":this.color.setBlue(n);break;case"hsb_h":this.color.setHue(n);break;case"hsb_s":this.color.setSaturation(n);break;case"hsb_b":this.color.setBrightness(n);break;case"alpha":this.color.setAlpha(n/100)}return this._refresh(),!1},_onSubmit:function(e){this._hide(),"function"==typeof this.config.onSelect&&this.config.onSelect.call(this,this.color)},_onBodyClick:function(e){0!==this.controls.$picker.has(e.target).length||_(e.target).hasClass("vision-color-picker")||this._hide()},show:function(e,t){t&&(this.color.setColor(t),this._refresh()),this._show(e)},hide:function(){this._hide()},destroy:function(){this._destroy()}};var u=new e({onSelect:function(e){var t=1==e.alpha?e.hex():e.rgba();s.setValue(r,t),s.scan(),p(),o.val(t)}});function p(){var e=n.data("callback");e&&s.changeDetector.compile(e)(t)}s.changeDetector.watch("$destroy",function(){u.destroy()}),s.watch(r,function(e){if(_(a).removeClass("vision-invalid"),null==e)o.val(null),i.find("> div > div").css({"background-color":""});else{var t=new c;t.setColor(e)?i.find("> div > div").css({"background-color":t.rgba()}):i.find("> div > div").css({"background-color":""}),o.val(e)}},{readOnly:!0})}},e.directives.al.tooltipplacement={restrict:"EA",link:function(e,t,n,i){var o=_(t),a=_("<select/>").addClass(o.get(0).className);a.append('<option value="none">none</option>'),a.append('<option value="top-left">top-left</option>'),a.append('<option value="top">top</option>'),a.append('<option value="top-right">top-right</option>'),a.append('<option value="right-top">right-top</option>'),a.append('<option value="right">right</option>'),a.append('<option value="right-bottom">right-bottom</option>'),a.append('<option value="bottom-right">bottom-right</option>'),a.append('<option value="bottom">bottom</option>'),a.append('<option value="bottom-left">bottom-left</option>'),a.append('<option value="left-bottom">left-bottom</option>'),a.append('<option value="left">left</option>'),a.append('<option value="left-top">left-top</option>'),o.append(a),a.unwrap(),a.on("change",function(e){var t=a.val();"none"==t&&(t=null),i.setValue(n,t),i.scan()}),i.watch(n,function(e){null==e?a.val("none"):a.val(e)},{readOnly:!0})}},e.directives.al.tooltiptrigger={restrict:"EA",link:function(e,t,n,i){var o=_(t),a=_("<select/>").addClass(o.get(0).className);a.append('<option value="none">none</option>'),a.append('<option value="hover">hover</option>'),a.append('<option value="focus">focus</option>'),a.append('<option value="click">click</option>'),a.append('<option value="clickbody">click & body</option>'),a.append('<option value="sticky">sticky</option>'),o.append(a),a.unwrap(),a.on("change",function(e){var t=a.val();"none"==t&&(t=null),i.setValue(n,t),i.scan()}),i.watch(n,function(e){null==e?a.val("none"):a.val(e)},{readOnly:!0})}},e.directives.al.popovertype={restrict:"EA",link:function(e,t,n,i){var o=_(t),a=_("<select/>").addClass(o.get(0).className);a.append('<option value="tooltip">tooltip</option>'),a.append('<option value="inbox">inbox</option>'),a.append('<option value="lightbox">lightbox</option>'),o.append(a),a.unwrap(),a.on("change",function(e){var t=a.val();"default"==t&&(t=null),i.setValue(n,t),i.scan()}),i.watch(n,function(e){null==e?a.val("default"):a.val(e)},{readOnly:!0})}},e.directives.al.popoverplacement={restrict:"EA",link:function(e,t,n,i){var o=_(t),a=_("<select/>").addClass(o.get(0).className);a.append('<option value="none">none</option>'),a.append('<option value="top-left">top-left</option>'),a.append('<option value="top">top</option>'),a.append('<option value="top-right">top-right</option>'),a.append('<option value="right-top">right-top</option>'),a.append('<option value="right">right</option>'),a.append('<option value="right-bottom">right-bottom</option>'),a.append('<option value="bottom-right">bottom-right</option>'),a.append('<option value="bottom">bottom</option>'),a.append('<option value="bottom-left">bottom-left</option>'),a.append('<option value="left-bottom">left-bottom</option>'),a.append('<option value="left">left</option>'),a.append('<option value="left-top">left-top</option>'),o.append(a),a.unwrap(),a.on("change",function(e){var t=a.val();"none"==t&&(t=null),i.setValue(n,t),i.scan()}),i.watch(n,function(e){null==e?a.val("none"):a.val(e)},{readOnly:!0})}},e.directives.al.popovertrigger={restrict:"EA",link:function(e,t,n,i){var o=_(t),a=_("<select/>").addClass(o.get(0).className);a.append('<option value="none">none</option>'),a.append('<option value="hover">hover</option>'),a.append('<option value="focus">focus</option>'),a.append('<option value="click">click</option>'),a.append('<option value="dblclick">dblclick</option>'),o.append(a),a.unwrap(),a.on("change",function(e){var t=a.val();"none"==t&&(t=null),i.setValue(n,t),i.scan()}),i.watch(n,function(e){null==e?a.val("none"):a.val(e)},{readOnly:!0})}},n.alight=e,n.rootScope=n.alight(document.querySelectorAll("#vision-app-item")[0],{appData:n}),n.fn.init(n)}):_("#vision-app-settings").length&&(t={alight:null,rootScope:null,wp_ajax_url:null,wp_ajax_nonce:null,wp_ajax_action_update:null,wp_ajax_action_get:null,wp_ajax_action_delete_data:null,wp_ajax_msg_error:null,themes:null,config:{themeJavaScript:null,themeCSS:null},ui:{tabs:{general:!0,actions:!1}},fn:{init:function(e){_("#vision-app-settings").removeAttr("style"),e.plan=vision_globals.plan,e.wp_ajax_url=vision_globals.ajax_url,e.wp_ajax_nonce=vision_globals.ajax_nonce,e.wp_ajax_action_update=vision_globals.ajax_action_update,e.wp_ajax_action_get=vision_globals.ajax_action_get,e.wp_ajax_action_delete_data=vision_globals.ajax_action_delete_data,e.wp_ajax_msg_error=vision_globals.ajax_msg_error,e.fn.initConfig(e)},enableLoading:function(e){_("#vision-app-settings").removeClass("vision-active")},disableLoading:function(e){setTimeout(function(){_("#vision-app-settings").addClass("vision-active")},1e3)},loadThemes:function(i){var o=_.Deferred();return _.ajax({url:i.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:i.wp_ajax_nonce,action:i.wp_ajax_action_get,type:"editor-themes"},success:function(e){e&&e.success?o.resolve(e.data.list):this.error()},error:function(e,t,n){i.fn.showNotice(i,i.wp_ajax_msg_error,"notice-error"),o.resolve(null)}}),o.promise()},initConfig:function(n){n.fn.enableLoading(n),n.fn.loadThemes(n).done(function(e){n.themes=e}).always(function(){if(vision_globals.config){var e=_.extend(!0,{},JSON.parse(vision_globals.config));if(e)for(var t in e)n.config.hasOwnProperty(t)&&(n.config[t]=e[t])}n.rootScope.scan(),n.fn.disableLoading(n)})},saveConfig:function(t){t.fn.enableLoading(t);var e=_.extend(!0,{},t.config);e=JSON.stringify(e),_.ajax({url:t.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:t.wp_ajax_nonce,action:t.wp_ajax_action_update,config:e}}).done(function(e){e?t.fn.showNotice(t,e.data.msg,e.success?"notice-success":"notice-error"):t.fn.showNotice(t,t.wp_ajax_msg_error,"notice-error")}).fail(function(){t.fn.showNotice(t,t.wp_ajax_msg_error,"notice-error")}).always(function(){t.fn.disableLoading(t)})},deleteAllData:function(t,e){confirm(e)&&(t.fn.enableLoading(t),_.ajax({url:t.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:t.wp_ajax_nonce,action:t.wp_ajax_action_delete_data}}).done(function(e){e?t.fn.showNotice(t,e.data.msg,e.success?"notice-success":"notice-error"):t.fn.showNotice(t,t.wp_ajax_msg_error,"notice-error")}).fail(function(){t.fn.showNotice(t,t.wp_ajax_msg_error,"notice-error")}).always(function(){t.fn.disableLoading(t)}))},showNotice:function(e,t,n){var i=_("#vision-messages"),o=_("<div></div>").addClass("notice is-dismissible").addClass(n),a=_("<p></p>").html(t),r=_("<button></button>").attr("type","button").addClass("notice-dismiss").html('<span class="screen-reader-text">Dismiss this notice.</span>');function s(){clearTimeout(o.data("timer")),o.fadeTo(100,0,function(){o.slideUp(100,function(){o.remove()})})}o.data("timer",setTimeout(s,5e3)),r.click(function(e){e.preventDefault(),s()}),o.append(a,r),i.append(o)},onTab:function(e,t){if(!e.ui.tabs[t]){var n=e.ui.tabs;for(var i in n)n.hasOwnProperty(i)&&(n[i]=!1);e.ui.tabs[t]=!0}}}},window.alightInitCallback=function(e){delete window.alightInitCallback,e.directives.al.toggle={restrict:"EA",link:function(n,e,t,i){var o=_(e);o.addClass("vision-toggle").html("&nbsp;"),o.on("mousedown touchstart",function(e){i.setValue(t,!i.getValue(t)),i.scan(),function(){var e=o.data("callback");if(e){var t=i.changeDetector.compile(e);t(n)}}()}),i.watch(t,function(e){e?o.addClass("vision-checked").removeClass("vision-unchecked"):o.removeClass("vision-checked").addClass("vision-unchecked")},{readOnly:!0})}},t.alight=e,t.rootScope=t.alight(document.querySelectorAll("#vision-app-settings")[0],{appData:t}),t.fn.init(t)});var i=_(".vision-page-info");i.length&&!Cookies.get("vision-page-info-hidden")&&i.addClass("vision-active").find(".vision-page-info-close").on("click",function(e){i.removeClass("vision-active"),Cookies.set("vision-page-info-hidden",!0,{expires:365})}),function(){function e(){var U=function(e,t){return U.bootstrap(e,t)};U.version="0.14.0",U.filters={},U.text={},U.core={},U.utils={},U.option={globalController:!1,removeAttribute:!0,domOptimization:!0,domOptimizationRemoveEmpty:!0,fastBinding:!0},U.debug={scan:0,directive:!1,watch:!1,watchText:!1,parser:!1},U.ctrl=U.controllers={},U.d=U.directives={al:{},bo:{},$global:{}},U.hooks={directive:[],binding:[]},U.priority={al:{app:2e3,checked:20,class:30,css:30,focused:20,if:700,ifnot:700,model:25,radio:25,repeat:1e3,select:20,stop:-10,value:20,on:10},$component:5,$attribute:-5};var e,t,n,i,o,u,y,a,r,w,j,c,f,_,p,s,x,l,k,T,B,d,h,N,v,O,I,m,g,b,C,S,E,$,D,A,L,M,F,R,H,z,V,P,X,W,Y,K,q,J,G,Z,Q,ee,te,ne,ie,oe,ae,re,se,le,ce,ue=U.f$={},pe=function(e,t){var n=e.indexOf(t);0<=n?e.splice(n,1):console.warn("trying to remove not exist item")};function de(t,e){var n,i=[],o=!1,a=e.cd,r=e.callback;if(e.filterConf.args.length){var s=[];e.filterConf.args.forEach(function(e,t){var n=a.watch(e,function(e){i[t+1]=e,c()});n.$.isStatic||s.push(n)});var l=!1,c=function(){l||(l=!0,a.watch("$onScanOnce",function(){if(l=!1,o){var e=t.apply(null,i);ue.isPromise(e)?e.then(function(e){r(e),a.scan()}):r(e)}}))};s.length&&(n=function(){s.forEach(function(e){return e.stop()})})}else c=function(){var e=t(i[0]);ue.isPromise(e)?e.then(function(e){r(e),a.scan()}):r(e)};return{onChange:function(e){o=!0,i[0]=e,c()},onStop:n,watchMode:e.watchMode}}function fe(e,t,n,i){i.setValue(i.attrArgument,t)}return ue.before=function(e,t){e.parentNode.insertBefore(t,e)},ue.after=function(e,t){var n=e.parentNode,i=e.nextSibling;i?n.insertBefore(t,i):n.appendChild(t)},ue.remove=function(e){var t=e.parentNode;t&&t.removeChild(e)},ue.on=function(e,t,n){e.addEventListener(t,n,!1)},ue.off=function(e,t,n){e.removeEventListener(t,n,!1)},ue.isFunction=function(e){return e&&"[object Function]"===Object.prototype.toString.call(e)},ue.isObject=function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},ue.isPromise=function(e){return e&&window.Promise&&e instanceof window.Promise},ue.isElement=function(e){return e instanceof HTMLElement},ue.addClass=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},ue.removeClass=function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^| )"+t.split(" ").join("|")+"( |$)","gi")," ")},ue.rawAjax=function(e){var t=new XMLHttpRequest;for(var n in t.open(e.type||"GET",e.url,!0,e.username,e.password),e.headers)t.setRequestHeader(n,e.headers[n]);e.success&&(t.onload=function(){200<=t.status&&t.status<400?e.success(t.responseText):e.error&&e.error()}),e.error&&(t.onerror=e.error),t.send(e.data||null)},ue.ajaxCache={},ue.ajax=function(e){if(e.username||e.password||e.headers||e.data||!e.cache)return ue.rawAjax(e);var t=e.type||"GET",n=t+":"+e.url,i=ue.ajaxCache[n];i||(ue.ajaxCache[n]=i={callback:[]}),i.result?e.success&&e.success(i.result):(i.callback.push(e),i.loading||(i.loading=!0,ue.rawAjax({type:t,url:e.url,success:function(e){i.loading=!1,i.result=e;for(var t=0;t<i.callback.length;t++)i.callback[t].success&&i.callback[t].success(e);i.callback.length=0},error:function(){i.loading=!1;for(var e=0;e<i.callback.length;e++)i.callback[e].error&&i.callback[e].error();i.callback.length=0}})))},e='@charset "UTF-8";[al-cloak],[hidden],.al-hide{display:none !important;}',t=document.querySelectorAll("head")[0],(n=document.createElement("style")).setAttribute("type","text/css"),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),t.appendChild(n),ue.ready=(o=!(i=[]),ue.on(document,"DOMContentLoaded",function e(){o=!0,ue.off(document,"DOMContentLoaded",e);for(var t=0;t<i.length;t++)i[t]();i.length=0}),function(e){o?e():i.push(e)}),window.jQuery&&(window.jQuery.fn.alight=function(e){var n=[];if(this.each(function(e,t){return n.push(t)}),n.length)return U(n,e)}),U.core.getFilter=function(e,t){var n=t.locals[e];if(n&&(ue.isFunction(n)||n.init||n.fn))return n;if(n=U.filters[e])return n;throw"Filter not found: "+e},U.core.buildFilterNode=function(e,t,n,i){if(ue.isFunction(n))return de(n,{cd:e,filterConf:t,callback:i});if(n.init)return n.init.call(e,e.scope,t.raw,{setValue:i,conf:t,changeDetector:e});if(ue.isFunction(n.fn))return de(n.fn,{cd:e,filterConf:t,callback:i,watchMode:n.watchMode});throw"Wrong filter: "+t.name},U.ChangeDetector=function(e){var t,n;return n=new a,t=new u(n,e||{}),n.topCD=t},(a=function(){return this.watchers={any:[],finishBinding:[],finishScan:[],finishScanOnce:[],onScanOnce:[]},this.status=null,this.extraLoop=!1,this.finishBinding_lock=!1,this.lateScan=!1,this.topCD=null,this}).prototype.destroy=function(){if(this.watchers.any.length=0,this.watchers.finishBinding.length=0,this.watchers.finishScan.length=0,this.watchers.finishScanOnce.length=0,this.watchers.onScanOnce.length=0,this.topCD)return this.topCD.destroy()},(u=function(e,t){this.scope=t,this.locals=t,this.root=e,this.watchList=[],this.destroy_callbacks=[],this.parent=null,this.children=[],this.rwatchers={any:[],finishScan:[],elEvents:[]}}).prototype.new=function(e,t){var n,i,o;return t=t||{},o=this,null==e&&(e=o.scope),(i=new u(o.root,e)).parent=o,e===o.scope&&(t.locals?((n=o._ChildLocals)||(o._ChildLocals=n=function(){return this.$$root=e,this},n.prototype=o.locals),i.locals=new n):i.locals=o.locals),o.children.push(i),i},u.prototype.destroy=function(){var e,t,n,i,o,a,r,s,l,c,u,p,d,f,h,v,m,g,b,y,w,_,x;for(_=(e=this).root,e.scope=null,e.parent&&pe(e.parent.children,e),i=0,r=(v=e.destroy_callbacks).length;i<r;i++)(0,v[i])();for(o=0,s=(m=e.children.slice()).length;o<s;o++)m[o].destroy();for(a=e.destroy_callbacks.length=0,l=(g=e.watchList).length;a<l;a++)(t=g[a]).onStop&&t.onStop();for(d=e.watchList.length=0,c=(b=e.rwatchers.any).length;d<c;d++)x=b[d],pe(_.watchers.any,x);for(f=e.rwatchers.any.length=0,u=(y=e.rwatchers.finishScan).length;f<u;f++)x=y[f],pe(_.watchers.finishScan,x);for(h=e.rwatchers.finishScan.length=0,p=(w=this.rwatchers.elEvents).length;h<p;h++)n=w[h],ue.off(n[0],n[1],n[2]);this.rwatchers.elEvents.length=0,_.topCD===e&&(_.topCD=null,_.destroy())},r=function(e){return this.cb=e},s=function(e,t,n){var i,o;return i=e.root,o=new r(n),e.rwatchers[t].push(o),i.watchers[t].push(o),{stop:function(){return pe(e.rwatchers[t],o),pe(i.watchers[t],o)}}},u.prototype.on=function(e,t,n){return ue.on(e,t,n),this.rwatchers.elEvents.push([e,t,n])},f={$any:function(e,t){return s(e,"any",t)},$finishScan:function(e,t){return s(e,"finishScan",t)},$finishScanOnce:function(e,t){e.root.watchers.finishScanOnce.push(t)},$onScanOnce:function(e,t){e.root.watchers.onScanOnce.push(t)},$destroy:function(e,t){e.destroy_callbacks.push(t)},$finishBinding:function(e,t){e.root.watchers.finishBinding.push(t)}},x=function(){},u.prototype.watch=function(n,t,e){var i,o,a,r,s,l,c,u,p,d;if(s=f[n])return s(this,t);if(!0===(e=e||{})&&(e={isArray:!0}),e.init&&console.warn("watch.init is depricated"),(i=this).root,d=i.scope,ue.isFunction(n)?(r=n,u=U.utils.getId(),l=!0):(l=!1,r=null,"::"===(n=n.trim()).slice(0,2)&&(n=n.slice(2),e.oneTime=!0),u=n,u=e.deep?"d#"+u:e.isArray?"a#"+u:"v#"+u),U.debug.watch&&console.log("$watch",n),c=!1,!l)if(e.watchText)r=e.watchText.fn;else{if((o=U.utils.compile.expression(n)).filter)return function(t,e,n,i){var o=null,a=i.oneTime;if(i.isArray?o="array":i.deep&&(o="deep"),!n){var r={el:i.element,ea:i.elementAttr};n=function(e){j(t.scope,r,e)}}for(var s=U.utils.parsFilter(e.filter),l=[],c=s.result.length-1;0<=c;c--){var u=U.core.getFilter(s.result[c].name,t),p=U.core.buildFilterNode(t,s.result[c],u,n);p.watchMode&&(o=p.watchMode),p.onStop&&l.push(p.onStop),n=p.onChange}return i={oneTime:a},"array"===o?i.isArray=!0:"deep"===o&&(i.deep=!0),l.length&&(i.onStop=function(){l.forEach(function(e){return e()}),l.length=0}),t.watch(e.expression,n,i)}(i,o,t,e);c=o.isSimple&&0===o.simpleVariables.length,r=o.fn}return e.deep&&(e.isArray=!1),a={isStatic:c,isArray:Boolean(e.isArray),extraLoop:!e.readOnly,deep:!0===e.deep?10:e.deep,value:x,callback:t,exp:r,src:""+n,onStop:e.onStop||null,el:e.element||null,ea:e.elementAttr||null},c?i.watch("$onScanOnce",function(){return j(d,a,a.exp(d))}):i.watchList.push(a),p={$:a,stop:function(){var t;if(e.onStop)try{e.onStop()}catch(e){t=e,U.exceptionHandler(t,"Error in onStop of watcher: "+n,n)}if(!a.isStatic)return pe(i.watchList,a)},refresh:function(){var e;return(e=a.exp(i.locals))&&a.deep?a.value=U.utils.clone(e,a.deep):e&&a.isArray?a.value=e.slice():a.value=e}},e.oneTime&&(a.callback=function(e){if(void 0!==e)return p.stop(),t(e)}),p},u.prototype.watchGroup=function(e,t){var n,i,o,a,r,s;if(n=this,!t&&ue.isFunction(e)&&(t=e,e=null),s=!1,i=function(){if(!s)return s=!0,n.watch("$onScanOnce",function(){return s=!1,t()})},e)for(o=0,r=e.length;o<r;o++)a=e[o],n.watch(a,i);return i},c=window.performance?function(){return Math.floor(performance.now())}:function(){return(new Date).getTime()},_=function(e,t){var n,i,o,a;if(null===e||null===t)return!0;if((a=typeof e)!==typeof t)return!0;if("object"===a){if(e.length!==t.length)return!0;for(n=i=0,o=e.length;i<o;n=++i)if(e[n]!==t[n])return!0}return!1},j=function(e,t,n){t.el?t.ea?t.el.setAttribute(t.ea,n):t.el.nodeValue=n:t.callback.call(e,n)},w=function(e,t,n,i){var o,a;return o={src:n.src,scope:t.scope,locals:t.locals},n.el&&(o.element=n.el),a=1===i?"$scan, error in callback: ":"$scan, error in expression: ",U.exceptionHandler(e,a+n.src,o)},y=function(){},p=function(e,t){var n,i,o,a,r,s,l,c,u,p,d,f,h,v,m,g,b;if(e.root,s=!1,m=a=0,e){for(h=[],l=0,o=e;o;){for(d=o.locals,m+=o.watchList.length,c=0,p=(v=o.watchList.slice()).length;c<p;c++){u=(b=v[c]).value;try{g=b.exp(d)}catch(e){r=e,g=y}if(u!==g){if(f=!1,b.isArray?(n=Array.isArray(u))===(i=Array.isArray(g))?n?_(u,g)&&(f=!0,b.value=g.slice()):(f=!0,b.value=g):(f=!0,b.value=i?g.slice():g):b.deep?U.utils.equal(u,g,b.deep)||(f=!0,b.value=U.utils.clone(g,b.deep)):(f=!0,b.value=g),f)if(f=!1,g===y)w(r,o,b);else{a++;try{b.el?b.ea?null!=g?b.el.setAttribute(b.ea,g):b.el.removeAttribute(b.ea):b.el.nodeValue=g:(u===x&&(u=void 0),"$scanNoChanges"!==b.callback.call(o.scope,g,u)&&b.extraLoop&&(s=!0))}catch(e){w(r=e,o,b,1)}}1<U.debug.scan&&console.log("changed:",b.src)}}h.push.apply(h,o.children),o=h[l++]}t.total=m,t.changes=a,t.extraLoop=s}},u.prototype.digest=function(){var e,t,n,i,o,a,r,s,l;for(r=this.root,i=10,l=0,U.debug.scan&&(s=c()),a={total:0,changes:0,extraLoop:!1,src:"",scope:null,element:null};i;){if(i--,r.extraLoop=!1,r.watchers.onScanOnce.length)for(o=r.watchers.onScanOnce.slice(),t=r.watchers.onScanOnce.length=0,n=o.length;t<n;t++)o[t].call(r);if(p(this,a),l+=a.changes,!a.extraLoop&&!r.extraLoop&&!r.watchers.onScanOnce.length)break}return U.debug.scan&&(e=c()-s,console.log("$scan: loops: ("+(10-i)+"), last-loop changes: "+a.changes+", watches: "+a.total+" / "+e+"ms")),a.mainLoop=i,a.totalChanges=l,a},u.prototype.scan=function(e){var t,n,i,o,a,r,s,l,c,u,p;if(p=this.root,e=e||{},!U.option.zone||e.zone){if(ue.isFunction(e)&&(e={callback:e}),e.callback&&p.watchers.finishScanOnce.push(e.callback),e.late){if(p.lateScan)return;return p.lateScan=!0,void U.nextTick(function(){if(p.lateScan)return p.topCD.scan()})}if("scaning"!==p.status){if(p.lateScan=!1,p.status="scaning",(u=p.topCD?p.topCD.digest():{}).totalChanges)for(n=0,a=(l=p.watchers.any).length;n<a;n++)(0,l[n])();for(p.status=null,i=0,r=(c=p.watchers.finishScan).length;i<r;i++)(0,c[i])();for(t=p.watchers.finishScanOnce.slice(),o=p.watchers.finishScanOnce.length=0,s=t.length;o<s;o++)t[o].call(p);if(0===u.mainLoop)throw"Infinity loop detected";return u}p.extraLoop=!0}},(U.core.ChangeDetector=u).prototype.compile=function(e,t){return U.utils.compile.expression(e,t).fn},u.prototype.setValue=function(t,n){var i,o,a,r,s,l,c,u,p,d;a=(i=this).compile(t+" = $value",{input:["$value"],no_return:!0});try{return a(i.locals,n)}catch(e){if(o=e,u="can't set variable: "+t,U.debug.parser&&console.warn(u),0<=(""+o).indexOf("TypeError")&&(d=t.match(/^([\w\d\.]+)\.[\w\d]+$/))&&d[1]){for(c=i.locals,r=0,l=(p=d[1].split(".")).length;r<l;r++)void 0===c[s=p[r]]&&(c[s]={}),c=c[s];try{return void a(i.locals,n)}catch(e){}}return U.exceptionHandler(o,u,{name:t,value:n})}},u.prototype.eval=function(e){return this.compile(e)(this.locals)},u.prototype.getValue=function(e){return this.eval(e)},U.text.$base=function(t){var e,n,i,o,a;if(o=t.point,!(n=(a=(e=t.cd).scope).$ns&&a.$ns.text?a.$ns.text[t.name]:U.text[t.name]))throw"No directive alight.text."+t.name;return i={changeDetector:e,setter:function(e){if(t.update)return o.value=null===e?"":""+e,t.update()},setterRaw:function(e){if(t.updateRaw)return o.value=null===e?"":""+e,t.updateRaw()},finally:function(e){if(t.finally)return o.value=null===e?"":""+e,o.type="text",t.finally(),t.update=null,t.finally=null}},n.call(e,i.setter,t.exp,a,i)},l=function(e,t,n){var i,o,a,r,s,l,c,u,p,d,f,h,v,m,g,b,y,w,_,x,k,C,S,E,$,D,A,L,T;if(n=n||{},o=this,U.debug.watchText&&console.log("$watchText",e),E=U.utils.compile.buildSimpleText(e,null))o.watch(e,t,{watchText:E,element:n.element,elementAttr:n.elementAttr});else{for(s=U.utils.parsText(e),k=!(i=!(L=0)),c=u=l=function(){},v=0,b=s.length;v<b;v++)if("expression"===(r=s[v]).type)if(_=(p=r.list.join("|")).match(/^([^\w\d\s\$"'\(\u0410-\u044F\u0401\u0451]+)/))r.isDir=!0,x=_[1],p="#"===x?(h=p.indexOf(" "))<0?(x=p.substring(1),""):(x=p.slice(1,h),p.slice(h)):p.substring(x.length),U.text.$base({name:x,exp:p,cd:o,point:r,update:function(){return c()},updateRaw:function(){return u()},finally:function(){return c(),l()}}),k=!0,"text"!==r.type&&(i=!1);else if((a=U.utils.compile.expression(p,{string:!0})).filter)L++,i=!1,r.watched=!0,function(t){o.watch(p,function(e){return null==e&&(e=""),t.value=e,c()})}(r);else{if(r.fn=a.fn,!a.rawExpression)throw"Error";a.isSimple&&0===a.simpleVariables.length?(r.type="text",r.value=r.fn()):(r.re=a.rawExpression,L++)}if(i){if(L)return E=k?U.utils.compile.buildSimpleText(null,s):U.utils.compile.buildSimpleText(e,s),void o.watch(e,t,{watchText:{fn:E.fn},element:n.element,elementAttr:n.elementAttr});for(D="",m=0,y=s.length;m<y;m++)r=s[m],D+=r.value;o.watch("$onScanOnce",function(){return j(o.scope,{callback:t,el:n.element,ea:n.elementAttr},D)})}else if(T={callback:t,el:n.element,ea:n.elementAttr},s.scope=o.scope,f=U.utils.compile.buildText(e,s),u=function(){return j(o.scope,T,f())},L){for(A=null,S="",c=function(){S=f()},l=function(){var e,t;for(h=!0,e=0,t=s.length;e<t;e++)if("expression"===(r=s[e]).type){h=!1;break}h&&(o.watch("$finishScanOnce",function(){return A.stop()}),n.onStatic&&n.onStatic())},C=function(){return S},g=0,w=s.length;g<w;g++)if("expression"===(r=s[g]).type){if(r.isDir||r.watched)continue;r.watched=!0,function(t,e){o.watch(e,function(e){return null==e&&(e=""),t.value=e,c()})}(r,r.list.join(" | "))}c(),A=o.watch(C,t,{element:n.element,elementAttr:n.elementAttr})}else $=!1,d=function(){return $=!1,u()},(c=function(){if(!$)return $=!0,o.watch("$onScanOnce",d)})()}},u.prototype.watchText=l,k={TR:1,TD:1,LI:1},U.utils.optmizeElement=function(e,t){var n,i,o,a,r,s,l,c,u,p,d,f,h,v,m,g,b,y,w;if(1===e.nodeType){for(t=t||!U.option.domOptimizationRemoveEmpty,"PRE"===e.nodeName&&(t=!0),!(a=e.firstChild)||3!==a.nodeType||a.nodeValue.trim()||t||(ue.remove(a),a=e.firstChild),m=!1;a;)h=a.nextSibling,!m||3!==a.nodeType||a.nodeValue.trim()||t?(m=1===a.nodeType&&k[a.nodeName],U.utils.optmizeElement(a,t)):ue.remove(a),a=h;!(a=e.lastChild)||3!==a.nodeType||a.nodeValue.trim()||t||ue.remove(a)}else if(3===e.nodeType){if(y=e.data,d=U.utils.pars_start_tag,(s=y.indexOf(d))<0)return;if(y.slice(s+d.length).indexOf(d)<0)return;for(v="t",b=[n={value:""}],l=0,u=(o=U.utils.parsText(y)).length;l<u;l++)"text"===(i=o[l]).type?n.value+=i.value:(r=i.list.join("|"),w=U.utils.pars_start_tag+r+U.utils.pars_finish_tag,r.match(/^([^\w\d\s\$"'\(\u0410-\u044F\u0401\u0451]+)/)?("t"===v||"d"===v?n.value+=w:(n={value:w},b.push(n)),v="d"):1===i.list.length?("t"===v||"v"===v?n.value+=w:(n={value:w},b.push(n)),v="v"):"t"===v?n.value+=w:(n={value:w},b.push(n)));if(b.length<2)return;for((a=e).data=b[0].value,c=0,p=(g=b.slice(1)).length;c<p;c++)i=g[c],f=document.createTextNode(i.value),ue.after(a,f),a=f}},U.hooks.attribute=m=[],m.push({code:"dataPrefix",fn:function(){"data-"===this.attrName.slice(0,5)&&(this.attrName=this.attrName.slice(5))}}),m.push({code:"colonNameSpace",fn:function(){var e,t;this.directive||this.name||((t=(e=(t=this.attrName.match(/^(\w+)[\-\:](.+)$/))?(this.ns=t[1],t[2]):(this.ns="$global",this.attrName)).match(/^([^\.]+)\.(.*)$/))&&(e=t[1],this.attrArgument=t[2]),this.name=e.replace(/(-\w)/g,function(e){return e.substring(1).toUpperCase()}))}}),m.push({code:"getGlobalDirective",fn:function(){var e;if(!this.directive){if(!(e=U.d[this.ns]))return this.result="noNS",void(this.stop=!0);this.directive=e[this.name],this.directive||("$global"===this.ns?this.result="noNS":this.result="noDirective",this.stop=!0)}}}),m.push({code:"cloneDirective",fn:function(){var e,t,n,i,o,a;if(o=this.directive,i=this.ns,n=this.name,e={},ue.isFunction(o))e.init=o;else{if(!ue.isObject(o))throw"Wrong directive: "+i+"."+n;for(t in o)a=o[t],e[t]=a}if(e.priority=o.priority||U.priority[i]&&U.priority[i][n]||0,e.restrict=o.restrict||"A",e.restrict.indexOf(this.attrType)<0)throw"Directive has wrong binding (attribute/element): "+n;this.directive=e}}),m.push({code:"preprocessor",fn:function(){var r,s,l;l=this.ns,s=this.name,(r=this.directive).$init=function(e,t,n,i){var o,a;if(a={element:t,value:n,cd:e,env:i,ns:l,name:s,doBinding:(o=function(){var e,t,n,i;for(e=t=0,i=(n=a.procLine).length;t<i;e=++t)if(n[e].fn.call(a),a.isDeferred){a.procLine=n.slice(e+1);break}return a.async=!0,null},!1),directive:r,isDeferred:!1,procLine:U.hooks.directive,makeDeferred:function(){return a.isDeferred=!0,a.doBinding=!0,a.retStopBinding=!0,a.async=!1,function(){if(a.isDeferred=!1,a.async)return o()}}},r.stopBinding&&(i.stopBinding=!0),o(),a.retStopBinding)return"stopBinding"}}}),(g=U.hooks.directive).push({code:"init",fn:function(){var e;this.directive.init&&(U.debug.directive&&this.directive.scope&&console.warn(this.ns+"-"+this.name+" uses scope and init together, probably you need use link instead of init"),this.env.changeDetector=this.cd,(e=this.directive.init.call(this.env,this.cd.scope,this.element,this.value,this.env))&&e.start&&e.start())}}),g.push({code:"templateUrl",fn:function(){var t,n;(n=this).directive.templateUrl&&(t=this.makeDeferred(),ue.ajax({cache:!0,url:this.directive.templateUrl,success:function(e){return n.directive.template=e,t()},error:t}))}}),g.push({code:"template",fn:function(){var e;this.directive.template&&(1===this.element.nodeType?this.element.innerHTML=this.directive.template:8===this.element.nodeType&&((e=document.createElement("p")).innerHTML=this.directive.template.trim(),e=e.firstChild,ue.after(this.element,e),this.element=e,this.doBinding=!0))}}),g.push({code:"scope",fn:function(){var e,t;if(this.directive.scope){switch(t=this.cd,this.directive.scope){case!0:e=t.new({$parent:t.scope});break;case"root":e=U.ChangeDetector({$parent:t.scope}),t.watch("$destroy",function(){return e.destroy()});break;default:throw"Wrong scope value: "+this.directive.scope}this.env.parentChangeDetector=t,this.cd=e,this.doBinding=!0,this.retStopBinding=!0}}}),g.push({code:"link",fn:function(){var e;this.directive.link&&(this.env.changeDetector=this.cd,(e=this.directive.link.call(this.env,this.cd.scope,this.element,this.value,this.env))&&e.start&&e.start())}}),g.push({code:"scopeBinding",fn:function(){this.doBinding&&!this.env.stopBinding&&U.bind(this.cd,this.element,{skip_attr:this.env.skippedAttr()})}}),b=function(e,t,n){var i;"A"===t.attr_type?((i=n||{}).priority=U.priority.$attribute,i.is_attr=!0,i.name=e,i.attrName=e,i.element=t.element,t.list.push(i)):"M"===t.attr_type&&t.list.push(n)},I=function(e,t){var n,i,o,a;if(0<=t.skip_attr.indexOf(e))return b(e,t,{skip:!0});for(n={attrName:e,attrType:t.attr_type,element:t.element,cd:t.cd,result:null},i=0,o=(a=U.hooks.attribute).length;i<o&&(a[i].fn.call(n),!n.stop);i++);if("noNS"!==n.result)return"noDirective"===n.result?"E"===t.attr_type?void t.list.push({name:e,priority:-10,attrName:e,noDirective:!0}):void b(e,t,{noDirective:!0}):void t.list.push({name:e,directive:n.directive,priority:n.directive.priority,attrName:e,attrArgument:n.attrArgument});b(e,t)},O=function(e,t){return e.priority===t.priority?0:e.priority>t.priority?-1:1},B=function(e,t,n,i){var o;if(!((o=n).indexOf(U.utils.pars_start_tag)<0))return e.watchText(o,null,{element:t,elementAttr:i}),!0},v=function(e,t,n){var i;if(!((i=t.data).indexOf(U.utils.pars_start_tag)<0))return e.watchText(i,null,{element:t}),i},d=function(t,n,e){var i,o,a,r,s,l,c,u,p,d;if("directive:"===(p=n.nodeValue.trim()).slice(0,10)){if(d=0<=(c=(p=p.slice(10).trim()).indexOf(" "))?(a=p.slice(0,+(c-1)+1||9e9),p.slice(c+1)):(a=p,""),i={list:u=[],element:n,attr_type:"M",cd:t,skip_attr:[]},I(a,i),(o=u[0]).noDirective)throw"Comment directive not found: "+a;r=o.directive,l=new T({element:n,attrName:o.attrName,attributes:u}),U.debug.directive&&console.log("bind",o.attrName,d,o);try{r.$init(t,n,d,l)}catch(e){s=e,U.exceptionHandler(s,"Error in directive: "+o.name,{value:d,env:l,cd:t,scope:t.scope,element:n})}return l.skipToElement?{directive:1,skipToElement:l.skipToElement}:{directive:1,skipToElement:null}}},(T=function(e){var t,n;for(t in e)n=e[t],this[t]=n;return this}).prototype.takeAttr=function(e,t){var n,i,o,a;for(1===arguments.length&&(t=!0),i=0,o=(a=this.attributes).length;i<o;i++)if((n=a[i]).attrName===e)return t&&(n.skip=!0),this.element.getAttribute(e)||!0},T.prototype.skippedAttr=function(){var e,t,n,i,o;for(o=[],t=0,n=(i=this.attributes).length;t<n;t++)(e=i[t]).skip&&o.push(e.attrName);return o},T.prototype.scan=function(e){return this.changeDetector.scan(e)},T.prototype.on=function(e,t,n){return this.changeDetector.on(e,t,n)},T.prototype.watch=function(e,t,n){return this.changeDetector.watch(e,t,n)},T.prototype.watchGroup=function(e,t){return this.changeDetector.watchGroup(e,t)},T.prototype.watchText=function(e,t,n){return this.changeDetector.watchText(e,t,n)},T.prototype.getValue=function(e){return this.changeDetector.getValue(e)},T.prototype.setValue=function(e,t){return this.changeDetector.setValue(e,t)},T.prototype.eval=function(e){return this.changeDetector.eval(e)},T.prototype.new=function(e,t){return!0===t?t={locals:!0}:!0===e&&null==t&&(t={locals:!(e=null)}),this.changeDetector.new(e,t)},T.prototype.bind=function(e,t,n){var i,o,a,r,s,l,c;for(this.stopBinding=!0,s=a=0,l=arguments.length;s<l;s++)(i=arguments[s])instanceof u&&(o=i,a+=1),ue.isElement(i)&&(r=i,a+=1);return(c=arguments[a])||(c={skip:this.skippedAttr()}),r||(r=this.element),o||(o=this.changeDetector),U.bind(o,r,c)},h=function(t,o,e){var n,i,a,r,s,l,c,u,p,d,f,h,v,m,g,b,y,w,_,x,k,C,S,E,$,D,A,L;if(r={directive:0,hook:0,skipToElement:null,fb:v={attr:[],dir:[],children:[]}},$=!1,A=(e=e||{}).skip_attr,!0===e.skip?e.skip_top=!0:A||(A=e.skip||[]),A instanceof Array||(A=[A]),!e.skip_top){for(n={list:_=[],element:o,skip_attr:A,attr_type:"E",cd:t},a=o.nodeName.toLowerCase(),I(a,n),"script"!==a&&"style"!==a||($=!0),n.attr_type="A",g=0,b=(S=o.attributes).length;g<b;g++)i=S[g],I(i.name,n);if(e.attachDirective)for(a in E=e.attachDirective)E[a],I(a,n);for(x=0,y=(_=_.sort(O)).length;x<y;x++)if(!(u=_[x]).skip){if(u.noDirective)throw"Directive not found: "+u.name;if(u.skip=!0,L=e.attachDirective&&e.attachDirective[u.attrName]?e.attachDirective[u.attrName]:o.getAttribute(u.attrName),u.is_attr)B(t,o,L,u.attrName)&&v.attr.push({attrName:u.attrName,value:L});else{p=u.directive,f=new T({element:o,attrName:u.attrName,attrArgument:u.attrArgument||null,attributes:_,stopBinding:!1,elementCanBeRemoved:e.elementCanBeRemoved,fbElement:e.fbElement}),U.debug.directive&&console.log("bind",u.attrName,L,u);try{"stopBinding"===p.$init(t,o,L,f)&&($=!0)}catch(e){d=e,U.exceptionHandler(d,"Error in directive: "+u.attrName,{value:L,env:f,cd:t,scope:t.scope,element:o})}if(f.fastBinding?(h=ue.isFunction(f.fastBinding)?f.fastBinding:p.init,v.dir.push({fb:h,attrName:u.attrName,value:L,attrArgument:f.attrArgument,fbData:f.fbData})):r.directive++,f.stopBinding){$=!0;break}f.skipToElement&&(r.skipToElement=f.skipToElement)}}}if(!$)for(D=null,m=k=0,w=(l=function(){var e,t,n,i;for(i=[],t=0,e=(n=o.childNodes).length;t<e;t++)s=n[t],i.push(s);return i}()).length;k<w;m=++k)(s=l[m])&&(D?D===s&&(D=null):(e.fbElement&&(c={fbElement:e.fbElement.childNodes[m]}),C=N(t,s,c),r.directive+=C.directive,r.hook+=C.hook,D=C.skipToElement,C.fb&&(C.fb.text||C.fb.attr&&C.fb.attr.length||C.fb.dir&&C.fb.dir.length||C.fb.children&&C.fb.children.length)&&v.children.push({index:m,fb:C.fb})));return r},N=function(e,t,n){var i,o,a,r,s,l,c;if(l={directive:0,hook:0,skipToElement:null,fb:null},U.hooks.binding.length)for(o=0,a=(s=U.hooks.binding).length;o<a;o++)if(i=s[o],l.hook+=1,(r=i.fn(e,t,n))&&r.owner)return l;return 1===t.nodeType?(r=h(e,t,n),l.directive+=r.directive,l.hook+=r.hook,l.skipToElement=r.skipToElement,l.fb=r.fb):3===t.nodeType?(c=v(e,t))&&(l.fb={text:c}):8===t.nodeType&&(r=d(e,t))&&(l.directive+=r.directive,l.skipToElement=r.skipToElement),l},U.nextTick=(E=null,S=[],C=function(){var t,e,n,i,o,a,r;for(E=null,e=S.slice(),o=S.length=0,a=e.length;o<a;o++){t=(i=e[o])[0],r=i[1];try{t.call(r)}catch(e){n=e,U.exceptionHandler(n,"$nextTick, error in function",{fn:t,self:r})}}return null},function(e){if(S.push([e,this]),!E)return E=setTimeout(C,0)}),U.bind=function(e,t,n){var i,o,a,r,s,l;if(!e)throw"No changeDetector";if(!t)throw"No element";if(n=n||{},U.option.domOptimization&&!n.noDomOptimization&&U.utils.optmizeElement(t),(i=!(l=e.root).finishBinding_lock)&&(l.finishBinding_lock=!0,l.bindingResult={directive:0,hook:0}),s=N(e,t,n),l.bindingResult.directive+=s.directive,l.bindingResult.hook+=s.hook,e.digest(),i){for(l.finishBinding_lock=!1,r=l.watchers.finishBinding.slice(),o=l.watchers.finishBinding.length=0,a=r.length;o<a;o++)(0,r[o])();s.total=l.bindingResult}return s},function(){function s(e,t,n,i,o,a){i.callback.apply(null,a);var r=t._properties.root;r&&r.topCD&&r.topCD.scan({zone:!0})}var l=U.bind;U.bind=function(e,t,n){var i=e.root,o=U.option.zone;if(o){var a=!0===o?Zone:o,r=i.zone;if(r||(i.zone=r=a.current.fork({name:a.current.name+".x",properties:{root:i},onInvokeTask:s})),a.current!==r)return i.zone.run(l,null,[e,t,n])}return l(e,t,n)}}(),U.bootstrap=function(e,t){if(!e)return U.bootstrap("[al-app]"),U.bootstrap("[al\\:app]"),void U.bootstrap("[data-al-app]");var n;if(e instanceof U.core.ChangeDetector)n=e,e=t;else if(t instanceof U.core.ChangeDetector)n=t;else if(ue.isFunction(t)){var i={};n=U.ChangeDetector(i),t.call(n,i)}else t&&(n=U.ChangeDetector(t));if(Array.isArray(e)){for(var o=void 0,a=0,r=e;a<r.length;a++){var s=r[a];o=U.bootstrap(s,n)}return o}if("string"==typeof e){o=void 0;for(var l=0,c=document.querySelectorAll(e);l<c.length;l++){var u=c[l];o=U.bootstrap(u,n)}return o}if(n||(n=U.ChangeDetector()),ue.isElement(e)){for(var p,d,f,h=0,v=["al-app","al:app","data-al-app"];h<v.length&&(p=v[h],d=e.getAttribute(p),e.removeAttribute(p),!d);h++);return d&&(f={skip_attr:[p],attachDirective:{}},U.d.al.ctrl?f.attachDirective["al-ctrl"]=d:f.attachDirective[d+"!"]=""),U.bind(n,e,f),n}U.exceptionHandler("Error in bootstrap","Error input arguments",{input:e})},U.utils.getId=(L=function(){var e,t,n,i,o;for(o="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),n=Math.floor((new Date).valueOf()/1e3)-1388512800,i="";0<n;)t=n-62*(e=Math.floor(n/62)),n=e,i=o[t]+i;return i}(),A=1,function(){return L+"#"+A++}),U.utils.clone=$=function(i,o){var a,e,t,n;if(null==o&&(o=128),o<1)return null;if(!i)return i;if("object"!=typeof i)return i;if(i instanceof Array)return t=function(){var e,t,n;for(n=[],e=0,t=i.length;e<t;e++)a=i[e],n.push($(a,o-1));return n}();if(i instanceof Date)return new Date(i.valueOf());if(i.nodeType&&"function"==typeof i.cloneNode)return i;for(e in t={},i)n=i[e],"$"!==e[0]&&(t[e]=$(n,o-1));return t},U.utils.equal=D=function(e,t,n){var i,o,a,r,s,l,c;if(null==n&&(n=128),n<1)return!0;if(!e||!t)return e===t;if((l=typeof e)!==typeof t)return!1;if("object"!==l)return e===t;if(e instanceof Array){if(e.length!==t.length)return!1;for(i=o=0,r=e.length;o<r;i=++o)if(c=e[i],!D(c,t[i],n-1))return!1;return!0}if(e instanceof Date)return e.valueOf()===t.valueOf();if(e.nodeType&&"function"==typeof e.cloneNode)return e===t;for(a in s={},e)if(c=e[a],"$"!==a[0]&&(s[a]=!0,!D(c,t[a],n-1)))return!1;for(a in t)if(c=t[a],"$"!==a[0]&&!s[a]&&!D(c,e[a],n-1))return!1;return!0},U.exceptionHandler=function(e,t,n){var i;return i=[],t&&i.push(t),e&&e.message&&i.push(e.message),n&&i.push(n),e&&i.push(e.stack?e.stack:e),console.error.apply(console,i)},z=(V=function(){var e,t,n;for(n={},e=0,t=arguments.length;e<t;e++)n[arguments[e]]=!0;return n})("instanceof","typeof","in","null","true","false","undefined","return"),P=/[a-zA-Z\u0410-\u044F\u0401\u0451_\.\$]/,F=function(e){return e.match(P)},R=function(e){return 48<=e.charCodeAt()&&e.charCodeAt()<=57},X=V("+","-",">","<","=","&","|","^","!","~"),H=function(e){return X[e]||!1},M=V("=","+=","-=","++","--","|=","^=","&=","!=","<<=",">>="),U.utils.parsExpression=function(e,t){var h,v,n,p,m,x,g,b,d,k;return m=V.apply(null,(t=t||{}).input||[]),k=1,n=(x=function(e){var t,n,i,o,a,r,s,l,c,u,p,d,f,h,v,m,g,b,y,w,_;for(f=e.line,h=e.result||[],u=e.index||0,d=e.level||0,g=e.stopKey||null,m=!(_=[]),c=y=b=s=v=w="",o=0,l=p=null,r=function(){return c&&h.push({type:"free",value:c}),c=""};u<=f.length;)if(i=f[u-1],t=f[u++]||"",n=f[u],(m&&c||!t)&&r(),"string"!==m){if("key"===m){if(F(t)||R(t)){w+=t;continue}if("["===t){if(w+=t,!(a=x({line:f,index:u,level:d+1,stopKey:"]"})).stopKeyOk)throw"Error expression";u=a.index,w+="###"+a.uniq+"###]",_.push(a);continue}if("?"===t&&("."===n||"("===n||"["===n)){w+=t;continue}if("("===t){if(w+=t,!(a=x({line:f,index:u,level:d+1,stopKey:")"})).stopKeyOk)throw"Error expression";u=a.index,w+="###"+a.uniq+"###)",_.push(a);continue}p={type:"key",value:w,start:u-w.length-1,finish:u-1,children:_},h.push(p),w=m="",_=[]}else if("sign"===m){if(H(t)){v+=t;continue}if("|"===v&&0===d&&0===o){l=f.substring(u-1),u=f.length+1;continue}(M[v]||"="===v[0]&&"="!==v[1])&&(p.assignment=!0),h.push({type:"sign",value:v}),v=m=""}else if("digit"===m){if(R(t)||"."===t){s+=t;continue}h.push({type:"digit",value:s}),s=""}if(F(t))m="key",w+=t;else if(H(t))m="sign",v+=t;else if(R(t))m="digit",s+=t;else if('"'!==t&&"'"!==t){if(t===g)return r(),{result:h,index:u,stopKeyOk:!0,uniq:k++};"("===t&&o++,")"===t&&o--,"{"!==t?(":"===t&&"}"===g&&(p.type="free"),c+=t):(r(),a=x({line:f,index:u,level:d+1,stopKey:"}"}),h.push({type:"{}",child:a}),u=a.index)}else m="string",y+=b=t}else{if(t===b&&"\\"!==i){y+=t,h.push({type:"string",value:y}),m=b=y="";continue}y+=t}return r(),{result:h,index:u,filter:l}})({line:e}),g={isSimple:!n.filter,simpleVariables:[]},n.filter?(g.expression=e.substring(0,e.length-n.filter.length-1),g.filter=n.filter):g.expression=e,b=function(e){var t;return{count:(t=e.split(/[\.\[\(\?]/)).length,firstPart:t[0]}},d=function(e,t){return t?"($$="+e+",$$==null)?undefined:":"($$=$$"+e+",$$==null)?undefined:"},p=function(e){return e.split(/[\.\[\(\?]/)[0]},v=function(e){var t,n,i,o,a,r,s,l,c,u;if("this"===e)return"$$scope";if(t=p(e),o=z[t]||m[t],"this"===t&&(e="$$scope"+e.slice(4),o=!0),1===(l=e.split("?")).length)return o?e:"$$scope."+e;for(n=o?(u=d(l[0],!0),l[0]):(u=d("scope."+l[0]),"scope."+l[0]),i=0,r=(c=l.slice(1,l.length-1)).length;i<r;i++)"("===(s=c[i])[0]?u+=d(n+s,o):(u+=d(s),n+=s);return"("===(a=l[l.length-1])[0]?(o||(u+="$$"),u+=n+a):u+="$$"+a,"("+u+")"},h=function(e){var t,n,i,o,a,r,s,l,c,u,p,d,f;for(d="",o=0,s=(u=e.result).length;o<s;o++)if("key"!==(i=u[o]).type)"{}"!==i.type?d+=i.value:d+="{"+h(i.child)+"}";else{if(i.assignment?(c="this"===(f=b(i.value)).firstPart?"$$scope"+i.value.substring(4):m[f.firstPart]?i.value:f.count<2?"($$scope.$$root || $$scope)."+i.value:"$$scope."+i.value,g.isSimple=!1):z[i.value]?c=i.value:(c=v(i.value),g.simpleVariables.push(c)),i.children.length)for(a=0,l=(p=i.children).length;a<l;a++)r="###"+(t=p[a]).uniq+"###",n=h(t),c=c.split(r).join(n);d+=c}return d},g.result=h(n),U.debug.parser&&console.log(e,g),g},U.utils.parsFilter=function(e){var t,n,i;for(i=[],e=e.trim();e;){if(!(t=e.match(/^(\w+)([^\w])(.*)$/))){if(!(t=e.match(/^(\w+)$/)))return null;i.push({name:t[1],args:[],raw:""});break}e="|"===t[2]?(i.push({name:t[1],args:[],raw:""}),t[3]):(n=U.utils.parsArguments(t[3],{stop:"|"}),i.push({name:t[1],args:n.result,raw:t[3].slice(0,n.length)}),t[3].slice(n.length+1).trim())}return{result:i}},U.utils.parsArguments=function(e,t){var n,i,o,a,r,s,l,c;for(t=t||{},i="",a=r=0,c=l=!(o=[]),s=function(){i&&(o.push(i),i="")};r<=e.length;)if(n=e[r]||"",r++,l)i+=n,'"'===n&&(l=!1);else if(c)i+=n,"'"===n&&(c=!1);else if('"'!==n)if("'"!==n)if(a)i+=n,"("===n&&a++,")"===n&&a--;else if(" "!==n&&","!==n){if(t.stop&&t.stop===n){s();break}"("===n&&(a=1),i+=n}else s();else i+=n,c=!0;else i+=n,l=!0;return s(),{result:o,length:r-1}},U.utils.pars_start_tag="{{",U.utils.pars_finish_tag="}}",K=function(r){var s,l,c,u,n,p,d,o;return o=U.utils.pars_start_tag,s=U.utils.pars_finish_tag,p=[],n=c=0,l=function(e){var t;return e=e||1,t=r.substring(n,c-e),n=c,t},d=null,u=function(e,t,n){var i,o,a;for(e||(d={type:"expression",list:[]},p.push(d)),i=null;c<r.length;){if(o=i+(i=r[c]),a=r[c+=1],i===t)return;if(!n){if(o===s&&0===e)return d.list.push(l(2)),!0;"("===i?u(e+1,")"):"{"===i?u(e+1,"}"):'"'===i?u(e+1,'"',!0):"'"===i?u(e+1,"'",!0):"|"===i&&0===e&&("|"===a?c+=1:d.list.push(l()))}}},function(){var e,t,n,i;for(e=t=null;c<r.length;)if(t=e,e=r[c],c+=1,t+e===o){if((i=l(2))&&p.push({type:"text",value:i}),!u(0))throw"Wrong expression"+r;e=null}if(n=l(-1))p.push({type:"text",value:n})}(),U.debug.parser&&console.log("parsText",p),p},W={},Y=function(i){var o,a;return function(){var e,t,n;for(n=[],e=0,t=i.length;e<t;e++)o=i[e],a={type:o.type,value:o.value},o.list&&(a.list=o.list.slice()),n.push(a);return n}()},U.utils.parsText=function(e){var t;return(t=W[e])||(W[e]=t=K(e)),Y(t)},U.utils.compile=q={},q.cache={},q.Function=Function,q.expression=function(t,n){var e,i,o,a,r,s,l;if(n=n||{},s=(t=t.trim())+"#",s+=n.no_return?"+":"-",s+=n.string?"s":"v",n.input&&(s+=n.input.join(",")),r=q.cache[s])return r;o=(r=U.utils.parsExpression(t,{input:n.input})).result,n.no_return?l="var $$;"+o:n.string&&!r.filter?(l="var $$, __ = ("+o+"); return '' + (__ || (__ == null?'':__))",r.rawExpression="(__="+o+") || (__ == null?'':__)"):l="var $$;return ("+o+")";try{a=n.input?((e=n.input.slice()).unshift("$$scope"),e.push(l),q.Function.apply(null,e)):q.Function("$$scope",l)}catch(e){throw i=e,U.exceptionHandler(i,"Wrong expression: "+t,{src:t,cfg:n}),"Wrong expression: "+o}return r.fn=a,q.cache[s]=r},q.cacheText={},q.buildText=function(e,t){var n,i,o,a,r,s,l;if(o=q.cacheText[e])return function(){return o.call(t)};for(l=[],r=a=0,s=t.length;a<s;r=++a)"expression"===(n=t[r]).type?n.fn?l.push("this["+r+"].fn(this.scope)"):l.push("((x=this["+r+"].value) || (x == null?'':x))"):n.value&&(i=n.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n"),l.push('"'+i+'"'));return l=l.join(" + "),o=q.Function("var x; return ("+l+")"),q.cacheText[e]=o,function(){return o.call(t)}},q.cacheSimpleText={},q.buildSimpleText=function(e,t){var n,i,o,a,r,s,l,c;if((r=e?q.cacheSimpleText[e]:null)||!t)return r||null;for(l=[],c=[],a=o=0,s=t.length;o<s;a=++o)"expression"===(n=t[a]).type?(l.push("("+n.re+")"),n.simpleVariables&&c.push.apply(c,n.simpleVariables)):n.value&&(i=n.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n"),l.push('"'+i+'"'));return l=l.join(" + "),r={fn:q.Function("$$scope","var $$, __; return ("+l+")"),simpleVariables:c},e&&(q.cacheSimpleText[e]=r),r},Z=function(e){var t,n,i;if(!e.length)return"el";for(i="el",t=0,n=e.length;t<n;t++)i+=".childNodes["+e[t]+"]";return i},G=function(e){var t,n,i,o,a,r;for(o=0,r=(i=U.utils.parsText(e)).length;o<r;o++)if("expression"===(n=i[o]).type){if(1<n.list.length)return null;if("#"===(a=n.list[0])[0])return null;if("="===a[0])return null;if("::"===a.slice(0,2))return null;if(!(t=U.utils.compile.expression(a,{string:!0})).rawExpression)throw"Error";n.re=t.rawExpression}return U.utils.compile.buildSimpleText(e,i).fn},U.core.fastBinding=function(e){if(U.option.fastBinding&&!e.directive&&!e.hook&&e.fb)return new J(e)},(J=function(e){var b,y,w,_;return w=[],(y=this).fastWatchFn=[],b=[],(_=function(e,t){var n,i,o,a,r,s,l,c,u,p,d,f,h,v,m,g;if(e.dir)for(v=Z(b),a=0,c=(d=e.dir).length;a<c;a++)n=d[a],w.push("s.dir("+y.fastWatchFn.length+", "+v+");"),y.fastWatchFn.push(n);if(e.attr)for(r=0,u=(f=e.attr).length;r<u;r++)g=(o=f[r]).value,s=o.attrName,v=Z(b),i=G(g),m=g.replace(/"/g,'\\"').replace(/\n/g,"\\n"),i?(w.push('s.fw("'+m+'", '+y.fastWatchFn.length+", "+v+', "'+s+'");'),y.fastWatchFn.push(i)):w.push("s.wt('"+m+"', "+v+", '"+s+"');");if(e.text&&(v=Z(b),i=G(e.text),m=e.text.replace(/"/g,'\\"').replace(/\n/g,"\\n"),i?(w.push('s.fw("'+m+'", '+y.fastWatchFn.length+", "+v+");"),y.fastWatchFn.push(i)):w.push('s.wt("'+m+'", '+v+");")),e.children)for(l=0,p=(h=e.children).length;l<p;l++)o=h[l],b.length=t+1,b[t]=o.index,_(o.fb,t+1)})(e.fb,0),w=w.join("\n"),y.resultFn=U.utils.compile.Function("s","el","f$",w),this}).prototype.bind=function(e,t){this.currentCD=e,this.resultFn(this,t,ue)},J.prototype.dir=function(e,t){var n,i,o,a;i=this.fastWatchFn[e],n=this.currentCD,o=new T({attrName:i.attrName,attrArgument:i.attrArgument,changeDetector:n,fbData:i.fbData}),(a=i.fb.call(o,n.scope,t,i.value,o))&&a.start&&a.start()},J.prototype.fw=function(e,t,n,i){var o,a,r,s;o=this.currentCD,s={isStatic:!1,isArray:!1,extraLoop:!1,deep:!1,value:r=(a=this.fastWatchFn[t])(o.locals),callback:null,exp:a,src:e,onStop:null,el:n,ea:i||null},o.watchList.push(s),j(o.scope,s,r)},J.prototype.wt=function(e,t,n){this.currentCD.watchText(e,null,{element:t,elementAttr:n})},U.hooks.attribute.unshift({code:"events",fn:function(){var e;(e=this.attrName.match(/^\@([\w\.\-]+)$/))&&(this.ns="al",this.name="on",this.attrArgument=e[1])}}),U.hooks.eventModifier={},(re=function(e,n){return U.hooks.eventModifier[e]={event:["keydown","keypress","keyup"],fn:function(e,t){e[n]||(t.stop=!0)}}})("alt","altKey"),re("control","ctrlKey"),re("ctrl","ctrlKey"),re("meta","metaKey"),re("shift","shiftKey"),U.hooks.eventModifier.self=function(e,t){if(e.target!==t.element)return t.stop=!0},U.hooks.eventModifier.once={beforeExec:function(e,t){return t.unbind()}},te=function(e,t){var n,i,o,a,r,s;if(s={},"string"==typeof e?s.event=e:"object"==typeof e&&e.event&&(s.event=e.event),"string"==typeof s.event&&(s.event=s.event.split(/\s+/)),t&&s.event){for(o=!1,i=0,a=(r=s.event).length;i<a;i++)if(n=r[i],0<=t.indexOf(n)){o=!0;break}if(!o)return null}return ue.isFunction(e)?s.fn=e:e.fn&&(s.fn=e.fn),e.beforeExec&&(s.beforeExec=e.beforeExec),e.init&&(s.init=e.init),s},U.d.al.on=function(e,t,n,i){var u,o;i.attrArgument&&(U.option.removeAttribute&&(t.removeAttribute(i.attrName),i.fbElement&&i.fbElement.removeAttribute(i.attrName)),o=i.attrArgument.split(".")[0],(u=function(){}).prototype=ae(i.attrArgument,Q[o]),n&&(u.prototype.fn=i.changeDetector.compile(n,{no_return:!0,input:["$event","$element","$value"]})),u.prototype.expression=n,i.fastBinding=function(e,i,t,n){var o,a,r,s,l,c;for((r=new u).scope=e,r.element=i,r.cd=n.changeDetector,o=function(e){return ie(r,e)},s=0,l=(c=r.eventList).length;s<l;s++)a=c[s],ue.on(i,a,o);r.initFn&&r.initFn(e,i,t,n),r.unbind=function(){var e,t,n;for(e=0,t=(n=r.eventList).length;e<t;e++)a=n[e],ue.off(i,a,o)},n.changeDetector.watch("$destroy",r.unbind)},i.fastBinding(e,t,n,i))},oe={enter:13,tab:9,delete:46,backspace:8,esc:27,space:32,up:38,down:40,left:37,right:39},Q={click:{stop:!0,prevent:!0},dblclick:{stop:!0,prevent:!0},submit:{stop:!0,prevent:!0},keyup:{filterByKey:!0},keypress:{filterByKey:!0},keydown:{filterByKey:!0}},ae=function(e,t){var n,i,o,a,r,s,l,c,u;for(i={attrArgument:e,throttle:null,throttleTime:0,debounce:null,debounceId:null,initFn:null,eventList:null,stop:(t=t||{}).stop||!1,prevent:t.prevent||!1,scan:!0,modifiers:[]},o=(n=e.split("."))[0],a=null,(c=U.hooks.eventModifier[o])&&(c=te(c)).event&&(i.eventList=c.event,c.fn&&i.modifiers.push(c),c.init&&(i.initFn=c.init)),i.eventList||(i.eventList=[o]),r=0,l=(u=n.slice(1)).length;r<l;r++)"stop"!==(s=u[r])?"prevent"!==s?"nostop"!==s?"noprevent"!==s?"noscan"!==s?"throttle-"!==s.substring(0,9)?"debounce-"!==s.substring(0,9)?(c=U.hooks.eventModifier[s])?(c=te(c,i.eventList))&&i.modifiers.push(c):t.filterByKey&&(null===a&&(a={}),oe[s]&&(s=oe[s]),a[s]=!0):i.debounce=Number(s.substring(9)):i.throttle=Number(s.substring(9)):i.scan=!1:i.prevent=!1:i.stop=!1:i.prevent=!0:i.stop=!0;return i.filterByKey=a,i},ne=function(e,t){var n;return"checkbox"===(n=e.element).type?n.checked:"radio"===n.type?n.value||n.checked:t.component?t.value:n.value},ee=function(t,n){var i,e,o,a,r;for(e=0,o=(r=t.modifiers).length;e<o;e++)(a=r[e]).beforeExec&&a.beforeExec(n,t);if(t.fn)try{t.fn(t.cd.locals,n,t.element,ne(t,n))}catch(e){i=e,U.exceptionHandler(i,"Error in event: "+t.attrArgument+" = "+t.expression,{attr:t.attrArgument,exp:t.expression,scope:t.scope,cd:t.cd,element:t.element,event:n})}t.scan&&t.cd.scan()},ie=function(e,t){var n,i,o,a,r,s;if(!e.filterByKey||e.filterByKey[t.keyCode]){if(e.modifiers.length)for((n=function(){}).prototype=e,(i=new n).stop=!1,o=0,a=(s=e.modifiers).length;o<a;o++)if((r=s[o]).fn&&(r.fn(t,i),i.stop))return;e.prevent&&t.preventDefault(),e.stop&&t.stopPropagation(),e.debounce?(e.debounceId&&clearTimeout(e.debounceId),e.debounceId=setTimeout(function(){return e.debounceId=null,ee(e,t)},e.debounce)):e.throttle?e.throttleTime<Date.now()&&(e.throttleTime=Date.now()+e.throttle,ee(e,t)):ee(e,t)}},U.hooks.attribute.unshift({code:"directDirective",fn:function(){var e=this.attrName.match(/^(.*)\!$/);if(e){var t=e[1].replace(/(-\w)/g,function(e){return e.substring(1).toUpperCase()}),l=this.cd.locals[t]||U.ctrl[t]||U.option.globalController&&window[t];ue.isFunction(l)?this.directive=function(e,t,n,i){var o=i.changeDetector;if(n){for(var a=U.utils.parsArguments(n),r=Array(a.result.length),s=0;s<a.result.length;s++)r[s]=U.utils.compile.expression(a.result[s],{input:["$element","$env"]}).fn(o.locals,t,i);l.apply(o,r)}else l.call(o,e,t,n,i)}:(this.result="noDirective",this.stop=!0)}}}),U.hooks.attribute.unshift({code:"elementVariable",fn:function(){var e=this.attrName.match(/^#([\w\.]*)$/);e&&(this.directive=fe,this.attrArgument=e[1])}}),U.d.al.value=function(e,t,n,i){var o,a;return i.fastBinding=!0,o=function(){i.setValue(n,t.value),a.refresh(),i.scan()},i.on(t,"input",o),i.on(t,"change",o),a=i.watch(n,function(e){return null==e&&(e=""),t.value=e,"$scanNoChanges"})},U.d.al.checked=function(e,n,t,i){var o=i.fbData={opt:{},watch:[]};function a(e){var t=i.takeAttr(e);return U.option.removeAttribute&&(n.removeAttribute(e),i.fbElement&&i.fbElement.removeAttribute(e)),t}function r(e,t){var n=a(t);if(n)return o.opt[e]=n,!0;var i=a(":"+t)||a("al-attr."+t);return i?(o.watch.push([i,e]),!0):void 0}function l(n,i,o){for(var e in i.fbData.opt)n[e]=i.fbData.opt[e];for(var t=function(e){var t=e[1];i.watch(e[0],function(e){n[t]=e,o()})},a=0,r=i.fbData.watch;a<r.length;a++){t(r[a])}}r("value","value")?i.fastBinding=function(e,t,n,i){var o,a=null;function r(){return t.checked=a&&0<=a.indexOf(s.value),"$scanNoChanges"}var s={};l(s,i,r),o=i.watch(n,function(e){a=e,Array.isArray(a)||(a=null),r()},{isArray:!0}),i.on(t,"change",function(){if(a||(a=[],i.setValue(n,a)),t.checked)a.indexOf(s.value)<0&&a.push(s.value);else{var e=a.indexOf(s.value);0<=e&&a.splice(e,1)}o.refresh(),i.scan()})}:(r("true","true-value"),r("false","false-value"),i.fastBinding=function(e,t,n,i){var o,a,r={true:!0,false:!1};function s(){return t.checked=o===r.true,"$scanNoChanges"}l(r,i,s),a=i.watch(n,function(e){o=e,s()}),i.on(t,"change",function(){o=t.checked?r.true:r.false,i.setValue(n,o),a.refresh(),i.scan()})}),i.fastBinding(e,n,t,i)},U.d.al.if=function(e,t,n,i){var o;return i.elementCanBeRemoved?(U.exceptionHandler(null,i.attrName+" can't control element because of "+i.elementCanBeRemoved,{scope:e,element:t,value:n,env:i}),{}):(i.stopBinding=!0,o={item:null,childCD:null,base_element:null,top_element:null,start:function(){o.prepare(),o.watchModel()},prepare:function(){o.base_element=t,o.top_element=document.createComment(" "+i.attrName+": "+n+" "),ue.before(t,o.top_element),ue.remove(t)},updateDom:function(e){e?o.insertBlock(e):o.removeBlock()},removeBlock:function(){o.childCD&&(o.childCD.destroy(),o.childCD=null,o.removeDom(o.item),o.item=null)},insertBlock:function(){o.childCD||(o.item=o.base_element.cloneNode(!0),o.insertDom(o.top_element,o.item),o.childCD=i.changeDetector.new(),U.bind(o.childCD,o.item,{skip_attr:i.skippedAttr(),elementCanBeRemoved:i.attrName}))},watchModel:function(){i.watch(n,o.updateDom)},removeDom:function(e){ue.remove(e)},insertDom:function(e,t){ue.after(e,t)}})},U.d.al.ifnot=function(e,t,n,i){var o;return(o=U.d.al.if(e,t,n,i)).updateDom=function(e){e?o.removeBlock():o.insertBlock()},o},U.directives.al.repeat={restrict:"AM",init:function(e,S,a,W){var s,Y;return W.elementCanBeRemoved?(U.exceptionHandler(null,W.attrName+" can't control element because of "+W.elementCanBeRemoved,{scope:e,element:S,value:a,env:W}),{}):(W.stopBinding=!0,s=W.changeDetector,Y={start:function(){Y.parsExpression(),Y.prepareDom(),Y.buildUpdateDom(),Y.watchModel()},parsExpression:function(){var e,t;if("("===(t=a.trim())[0])if(Y.objectMode=!0,e=t.match(/\((\w+),\s*(\w+)\)\s+in\s+(.+)\s+orderBy:(.+)\s*$/))Y.objectKey=e[1],Y.objectValue=e[2],Y.expression=e[3]+" | toArray:"+Y.objectKey+","+Y.objectValue+" | orderBy:"+e[4],Y.nameOfKey="$item",Y.trackExpression="$item."+Y.objectKey;else{if(!(e=t.match(/\((\w+),\s*(\w+)\)\s+in\s+(.+)\s*$/)))throw"Wrong repeat: "+a;Y.objectKey=e[1],Y.objectValue=e[2],Y.expression=e[3]+" | toArray:"+Y.objectKey+","+Y.objectValue,Y.nameOfKey="$item",Y.trackExpression="$item."+Y.objectKey}else{if((e=t.match(/(.*) track by ([\w\.\$\(\)]+)/))&&(Y.trackExpression=e[2],t=e[1]),!(e=t.match(/\s*(\w+)\s+in\s+(.+)/)))throw"Wrong repeat: "+a;Y.nameOfKey=e[1],Y.expression=e[2]}},watchModel:function(){var e;e=Y.objectMode?{deep:!0}:{isArray:!0},Y.watch=s.watch(Y.expression,Y.updateDom,e)},prepareDom:function(){var e,t,n,i,o;if(8===S.nodeType){for(Y.top_element=S,Y.element_list=t=[],e=S.nextSibling;e;){if(8===e.nodeType&&"/directive:"===(o=e.nodeValue.trim().split(/\s+/))[0]&&"al-repeat"===o[1]){W.skipToElement=e;break}t.push(e),e=e.nextSibling}for(n=0,i=t.length;n<i;n++)e=t[n],ue.remove(e)}else Y.base_element=S,Y.top_element=document.createComment(" "+a+" "),ue.before(S,Y.top_element),ue.remove(S),U.option.removeAttribute&&S.removeAttribute(W.attrName)},makeChild:function(e,t,n){var i;return i=s.new(null,{locals:!0}),Y.updateLocals(i,e,t,n),i},updateLocals:function(e,t,n,i){var o;o=e.locals,Y.objectMode?(o[Y.objectKey]=t[Y.objectKey],o[Y.objectValue]=t[Y.objectValue]):o[Y.nameOfKey]=t,o.$index=n,o.$first=0===n,o.$last=n===i.length-1},rawUpdateDom:function(e,t){var n,i,o,a,r,s;for(i=0,r=e.length;i<r;i++)n=e[i],ue.remove(n);for(a=0,s=t.length;a<s;a++)o=t[a],ue.after(o.after,o.element)},buildUpdateDom:function(){return Y.updateDom=(P=[],k=null,C=R=0,X=W.skippedAttr(),V="$index"===Y.trackExpression?(r={},z=function(e){return r[R]||null},H=function(e){null!=e.$id&&delete r[e.$id]},function(e,t){t.$id=R,r[R]=t}):Y.trackExpression?(r={},n=s.compile(Y.trackExpression,{input:["$id",Y.nameOfKey]}),i=function(e,t){return n(s.scope,e,t)},o=function(e){var t;return(t=e.$alite_id)?t:t=e.$alite_id=U.utils.getId()},z=function(e){var t;return null!=(t=i(o,e))?r[t]:null},H=function(e){var t;null!=(t=e.$id)&&delete r[t]},function(e,t){var n;n=i(o,e),t.$id=n,r[n]=t}):window.Map?(r=new Map,z=function(e){return r.get(e)},H=function(e){r.delete(e.item)},function(e,t){r.set(e,t)}):(r={},z=function(e){var t;return"object"!=typeof e?r[e]||null:(t=e.$alite_id)?r[t]:null},H=function(e){var t;t=e.$id,r[t]&&(e.$id=null,delete r[t])},function(e,t){var n;"object"==typeof e?(n=U.utils.getId(),e.$alite_id=n,t.$id=n,r[n]=t):(t.$id=e,r[e]=t)}),a=[],F=function(e){var t,n;if("object"==(n=typeof e))return e&&e.length?e:[];if("number"===n)t=Math.floor(e);else if("string"===n&&(t=Math.floor(e),isNaN(t)))return[];if(t<a.length)a.length=t;else for(;a.length<t;)a.push(a.length);return a},Y.element_list?function(e){var o,a,r,s,t,l,n,i,c,u,p,d,f,h,v,m,g,b,y,w,_,x,k,C,S,E,$,D,A,L,T,j,B,N,O,I,M;for(S=F(e),m=Y.top_element,s=[],L=[],c=0,g=P.length;c<g;c++)(A=P[c]).active=!1;for(R=f=0,b=S.length;f<b;R=++f)p=S[R],(A=z(p))&&(A.active=!0);for(t=[],h=0,y=P.length;h<y;h++)if(!(A=P[h]).active){for(A.prev&&(A.prev.next=A.next),A.next&&(A.next.prev=A.prev),H(A),A.CD.destroy(),v=0,w=(O=A.element_list).length;v<w;v++)l=O[v],t.push(l);A.next=null,A.prev=null,A.element_list=null}for(N=null,B=!(o=[]),n=Y.element_list.length-1,R=E=0,_=S.length;E<_;R=++E)if(p=S[R],A=z(d=p)){if(Y.updateLocals(A.CD,p,R,S),A.prev===N){if(B)for($=0,x=(I=A.element_list).length;$<x;$++)l=I[$],s.push({element:l,after:m}),m=l;m=(N=A).element_list[n],A.active=!0,L.push(A);continue}for((A.prev=N)&&(N.next=A),T=0,k=(M=A.element_list).length;T<k;T++)l=M[T],s.push({element:l,after:m}),m=l;B=!0,(N=A).active=!0,L.push(A)}else r=Y.makeChild(d,R,S),i=function(){var e,t,n,i;for(i=[],t=0,e=(n=Y.element_list).length;t<e;t++)a=n[t],l=a.cloneNode(!0),o.push({cd:r,el:l}),s.push({element:l,after:m}),i.push(m=l);return i}(),V(p,A={CD:r,element_list:i,prev:N,next:null,active:!0,item:p}),N?(D=N.next,((N.next=A).next=D)&&(D.prev=A)):0===R&&P[0]&&(D=P[0],(A.next=D).prev=A),N=A,L.push(A);for(P=L,Y.rawUpdateDom(t,s),t.length=0,j=s.length=0,C=o.length;j<C;j++)u=o[j],U.bind(u.cd,u.el,{skip_attr:X,elementCanBeRemoved:W.attrName,noDomOptimization:!0})}:function(e){var t,n,i,o,a,r,s,l,c,u,p,d,f,h,v,m,g,b,y,w,_,x;for(m=F(e),d=Y.top_element,C++,i=[],y=[],_=null,w=!(t=[]),R=r=0,f=m.length;r<f;R=++r)if(l=m[R],b=z(c=l)){if(Y.updateLocals(b.CD,l,R,m),b.prev===_){w&&i.push({element:b.element,after:_.element}),d=(_=b).element,b.version=C,y.push(b);continue}(b.prev=_)&&(_.next=b),i.push({element:b.element,after:d}),w=!0,d=b.element,(_=b).version=C,y.push(b)}else n=Y.makeChild(c,R,m),S=Y.base_element.cloneNode(!0),null===k?(a=Y.base_element.cloneNode(!0),x=U.bind(n,S,{skip_attr:X,elementCanBeRemoved:W.attrName,noDomOptimization:!0,fbElement:a}),(k=U.core.fastBinding(x)||!1)&&(Y.base_element=a)):t.push({cd:n,el:S}),i.push({element:S,after:d}),V(l,b={CD:n,element:d=S,prev:_,next:null,version:C,item:l}),_?(g=_.next,((_.next=b).next=g)&&(g.prev=b)):0===R&&P[0]&&(g=P[0],(b.next=g).prev=b),_=b,y.push(b);for(o=[],u=0,h=P.length;u<h;u++)(b=P[u]).version!==C&&(b.prev&&(b.prev.next=b.next),b.next&&(b.next.prev=b.prev),H(b),b.CD.destroy(),o.push(b.element),b.next=null,b.prev=null,b.element=null);for(P=y,Y.rawUpdateDom(o,i),o.length=0,p=i.length=0,v=t.length;p<v;p++)s=t[p],k?k.bind(s.cd,s.el):U.bind(s.cd,s.el,{skip_attr:X,elementCanBeRemoved:W.attrName,noDomOptimization:!0})});var i,o,k,a,F,R,r,H,z,V,P,X,C,n}})}},U.d.al.init=function(t,n,i,o){var a,r,e,s,l;U.option.removeAttribute&&(n.removeAttribute(o.attrName),o.fbElement&&o.fbElement.removeAttribute(o.attrName)),a=o.changeDetector,l=["$element"],"window"===o.attrArgument&&l.push("window");try{s=a.compile(i,{no_return:!0,input:l}),o.fastBinding=e=function(e,t,n,i){return s(i.changeDetector.locals,t,window)},e(0,n,0,o)}catch(e){r=e,U.exceptionHandler(r,"al-init, error in expression: "+i,{exp:i,scope:t,cd:a,element:n}),o.fastBinding=function(){}}},U.d.al.app={stopBinding:!0},U.d.al.stop={restrict:"AE",stopBinding:!0},U.d.al.cloak=function(e,t,n,i){t.removeAttribute(i.attrName),n&&ue.removeClass(t,n)},U.d.al.html={restrict:"AM",priority:100,modifier:{},link:function(o,a,r,s){var l;return s.elementCanBeRemoved&&8!==a.nodeType?(U.exceptionHandler(null,s.attrName+" can't control element because of "+s.elementCanBeRemoved,{scope:o,element:a,value:r,env:s}),{}):(s.stopBinding=!0,l={baseElement:null,topElement:null,activeElement:null,childCD:null,name:r,watchMode:null,start:function(){l.parsing(),l.prepare(),l.watchModel()},parsing:function(){var e,t,n,i;if(s.attrArgument)for(e=0,t=(i=s.attrArgument.split(".")).length;e<t;e++)"literal"!==(n=i[e])?"tpl"!==n?U.d.al.html.modifier[n]&&U.d.al.html.modifier[n](l,{scope:o,element:a,inputName:r,env:s}):l.watchMode="tpl":l.watchMode="literal"},prepare:function(){8===a.nodeType?(l.baseElement=null,l.topElement=a):(l.baseElement=a,l.topElement=document.createComment(" "+s.attrName+": "+r+" "),ue.before(a,l.topElement),ue.remove(a))},removeBlock:function(){var e,t,n,i;if(l.childCD&&(l.childCD.destroy(),l.childCD=null),l.activeElement){if(Array.isArray(l.activeElement))for(t=0,n=(i=l.activeElement).length;t<n;t++)e=i[t],l.removeDom(e);else l.removeDom(l.activeElement);l.activeElement=null}},insertBlock:function(e){var t,n,i;if(l.baseElement)l.activeElement=l.baseElement.cloneNode(!1),l.activeElement.innerHTML=e,l.insertDom(l.topElement,l.activeElement),l.childCD=s.changeDetector.new(),U.bind(l.childCD,l.activeElement,{skip_attr:s.skippedAttr(),elementCanBeRemoved:s.attrName});else for((i=document.createElement("body")).innerHTML=e,t=l.topElement,l.activeElement=[],l.childCD=s.changeDetector.new();n=i.firstChild;)l.insertDom(t,n),t=n,l.activeElement.push(n),U.bind(l.childCD,t,{skip_attr:s.skippedAttr(),elementCanBeRemoved:s.attrName})},updateDom:function(e){l.removeBlock(),e&&l.insertBlock(e)},removeDom:function(e){ue.remove(e)},insertDom:function(e,t){ue.after(e,t)},watchModel:function(){"literal"===l.watchMode?l.updateDom(l.name):"tpl"===l.watchMode?s.watchText(l.name,l.updateDom):s.watch(l.name,l.updateDom)}})}},U.d.al.html.modifier.id=function(i){return i.updateDom=function(e){var t,n;i.removeBlock(),(n=document.getElementById(e))&&(t=n.innerHTML)&&i.insertBlock(t)}},U.d.al.html.modifier.url=function(t){return t.loadHtml=function(e){ue.ajax(e)},t.updateDom=function(e){e?t.loadHtml({cache:!0,url:e,success:function(e){t.removeBlock(),t.insertBlock(e)},error:t.removeBlock}):t.removeBlock()}},U.d.al.html.modifier.scope=function(o,a){var e,r,s;if(2===(e=o.name.split(":")).length)o.name=e[0],s=e[1];else{if(e=o.name.match(/(.+)\:\s*\:\:([\d\w]+)$/))r=!0;else if(r=!1,!(e=o.name.match(/(.+)\:\s*([\.\w]+)$/)))throw"Wrong expression "+o.name;o.name=e[1],s=e[2]}return"outer",o.insertBlock=function(e){var t,n,i;o.activeElement=o.baseElement.cloneNode(!1),o.activeElement.innerHTML=e,o.insertDom(o.topElement,o.activeElement),n=a.env.changeDetector,(t=o.childCD=n.new(null,{locals:!0})).locals.outer=null,i=n.watch(s,function(e){return t.locals.outer=e},{oneTime:r}),o.childCD.watch("$destroy",function(){return i.stop()}),U.bind(o.childCD,o.activeElement,{skip_attr:a.env.skippedAttr()})}},U.d.al.html.modifier.inline=function(e,t){var n;return n=e.prepare,e.prepare=function(){return n(),t.env.setValue(e.name,e.baseElement.innerHTML)}},U.d.al.radio=function(e,t,n,i){var o,a,r;return o=i.takeAttr("al-value"),a=o?i.eval(o):i.takeAttr("value"),i.on(t,"change",function(){i.setValue(n,a),r.refresh(),i.scan()}),r=i.watch(n,function(e){return t.checked=a===e,"$scanNoChanges"})},window.Map?((se=function(){return this.idByItem=new Map,this.itemById={},this.index=1,this}).prototype.acquire=function(e){var t;return t="i"+this.index++,this.idByItem.set(e,t),this.itemById[t]=e,t},se.prototype.release=function(e){var t;t=this.itemById[e],delete this.itemById[e],this.idByItem.delete(t)},se.prototype.replace=function(e,t){var n;n=this.itemById[e],this.idByItem.delete(n),this.idByItem.set(t,e),this.itemById[e]=t},se.prototype.getId=function(e){return this.idByItem.get(e)},se.prototype.getItem=function(e){return this.itemById[e]||null}):((se=function(){return this.itemById={"i#null":null},this}).prototype.acquire=function(e){var t;return null===e?"i#null":("object"==typeof e?(t=e.$alite_id)||(e.$alite_id=t=U.utils.getId()):t=""+e,this.itemById[t]=e,t)},se.prototype.release=function(e){delete this.itemById[e]},se.prototype.replace=function(e,t){this.itemById[e]=t},se.prototype.getId=function(e){return null===e?"i#null":"object"==typeof e?e.$alite_id:""+e},se.prototype.getItem=function(e){return this.itemById[e]||null}),U.d.al.select=function(e,n,t,i){var o,a,r,s,l,c;return o=i.changeDetector.new(),i.stopBinding=!0,o.$select={mapper:r=new se},a=null,o.$select.change=function(){return U.nextTick(function(){return l(a)})},l=function(e){var t;return(t=r.getId(e))?n.value=t:n.selectedIndex=-1},c=o.watch(t,function(e){return l(a=e)}),s=function(e){return a=r.getItem(e.target.value),o.setValue(t,a),c.refresh(),o.scan()},i.on(n,"input",s),i.on(n,"change",s),U.bind(o,n,{skip_attr:i.skippedAttr()})},U.d.al.option=function(e,t,n,i){var o,a,r,s,l,c;for(o=c=i.changeDetector,r=0;r<=4&&!(l=c.$select);++r)c=c.parent||{};l?(s=l.mapper,a=null,o.watch(n,function(e){a?s.getId(e)!==a?(s.release(a),a=s.acquire(e),t.value=a,l.change()):s.replace(a,e):(a=s.acquire(e),t.value=a,l.change())}),o.watch("$destroy",function(){return s.release(a),l.change()})):U.exceptionHandler("","Error in al-option - al-select is not found",{cd:o,scope:o.scope,element:t,value:n})},U.hooks.attribute.unshift({code:"attribute",fn:function(){var e,t;(e=this.attrName.match(/^\:([\w\.\-]+)$/))&&("html"===(t=e[1]).split(".")[0]?(this.name="html",t=t.substring(5)):this.name="attr",this.ns="al",this.attrArgument=t)}}),le={checked:"checked",readonly:"readOnly",value:"value",selected:"selected",muted:"muted",disabled:"disabled",hidden:"hidden"},U.d.al.attr=function(e,t,o,n){var a,r,i,s,l,c,u,p,d,f;if(n.attrArgument){if(i=n.attrArgument.split("."),r=i[0],u=le[r],l=0<i.indexOf("tpl"),U.option.removeAttribute&&(t.removeAttribute(n.attrName),n.fbElement&&n.fbElement.removeAttribute(n.attrName)),a={readOnly:!0},p=null,"style"===r){if(!i[1])throw"Style is not declared";d=i[1].replace(/(-\w)/g,function(e){return e.substring(1).toUpperCase()}),p=function(e,t){return null==t&&(t=""),e.style[d]=t}}else"class"===r&&1<i.length?(l=!1,c=i.slice(1),p=function(e,t){var n,i,o,a,r;if(t)for(i=0,a=c.length;i<a;i++)n=c[i],ue.addClass(e,n);else for(o=0,r=c.length;o<r;o++)n=c[o],ue.removeClass(e,n)}):"focus"===r?p=function(e,t){return t?e.focus():e.blur()}:u?p=function(e,t){if(void 0===t&&(t=null),e[u]!==t)return e[u]=t}:(a.element=t,a.elementAttr=r);f=l?"watchText":"watch",(s=p?function(e,t,n,i){return i.changeDetector[f](o,function(e){return p(t,e)},a)}:function(e,t,n,i){return i.changeDetector[f](o,null,{readOnly:!0,element:t,elementAttr:r})})(e,t,o,n),n.fastBinding=s}},U.d.al.model=function(e,t,n,i){var o;if("select"===(o=t.nodeName.toLowerCase()))return U.d.al.select.call(this,e,t,n,i);if("input"===o){if("checkbox"===t.type)return U.d.al.checked.call(this,e,t,n,i);if("radio"===t.type)return U.d.al.radio.call(this,e,t,n,i)}return U.d.al.value.call(this,e,t,n,i)},U.filters.slice=function(e,t,n){return e?n?e.slice(t,n):e.slice(t):null},ce=function(e){return e<10?"0"+e:""+e},U.filters.date=function(e,t){var n,i,o,a,r;if(!e)return"";for(a=t,i=0,o=(r=[[/yyyy/g,(e=new Date(e)).getFullYear()],[/mm/g,ce(e.getMonth()+1)],[/dd/g,ce(e.getDate())],[/HH/g,ce(e.getHours())],[/MM/g,ce(e.getMinutes())],[/SS/g,ce(e.getSeconds())]]).length;i<o;i++)n=r[i],a=a.replace(n[0],n[1]);return a},U.filters.json={watchMode:"deep",fn:function(e){return JSON.stringify(U.utils.clone(e),null,4)}},U.filters.filter=function(e,t,n){var i,o,a,r,s,l,c,u,p,d,f;if(2===arguments.length)s=null,f=t;else{if(3!==arguments.length)return e;s=t,f=n}if(!e||null==f||""===f)return e;if(u=[],p=(""+f).toLowerCase(),s)for(o=0,l=e.length;o<l;o++)(i=e[o])[s]===f?u.push(i):0<=(""+i[s]).toLowerCase().indexOf(p)&&u.push(i);else for(a=0,c=e.length;a<c;a++)for(r in i=e[a])(d=i[r])===f?u.push(i):0<=(""+d).toLowerCase().indexOf(p)&&u.push(i);return u},U.filters.orderBy=function(e,n,i){return!e instanceof Array?null:(i=i?1:-1,e.sort(function(e,t){return e[n]<t[n]?-i:e[n]>t[n]?i:0}))},U.filters.throttle={init:function(e,t,n){var i;return t=Number(t),i=null,{onChange:function(e){return i&&clearTimeout(i),i=setTimeout(function(){return i=null,n.setValue(e),n.changeDetector.scan()},t)}}}},U.filters.toArray={init:function(e,t,o){var a,r,s;return s=2===o.conf.args.length?(a=o.conf.args[0],o.conf.args[1]):(a="key","value"),r=[],{watchMode:"deep",onChange:function(e){var t,n,i;for(n in r.length=0,e)i=e[n],(t={})[a]=n,t[s]=i,r.push(t);return o.setValue(r)}}}},U.filters.storeTo={init:function(e,t,n){return{onChange:function(e){return n.changeDetector.setValue(t,e),n.setValue(e)}}}},U.text["="]=function(e,t,n,i){var o;if((o=U.utils.compile.expression(t)).filters)throw"Conflict: bindonce and filters, use one-time binding";i.finally(o.fn(i.changeDetector.locals))},U.text["::"]=function(e,t,n,i){i.changeDetector.watch(t,function(e){return i.finally(e)},{oneTime:!0})},function(){var D=U.f$;function l(e){return e.replace(/(-\w)/g,function(e){return e.substring(1).toUpperCase()})}function A(e){var t,n=e.listener,i=e.childCD,o=e.name,a=e.parentName,r=e.parentCD,s={};if(o=l(o),n&&!0!==n)if(D.isFunction(n))t=n;else{if(t=n.onChange,"copy"===n||"copy"===n.watchMode)return void(t?t(a):i.scope[o]=a);"array"!==n&&"array"!==n.watchMode||(s.isArray=!0),"deep"!==n&&"deep"!==n.watchMode||(s.deep=!0)}t||(t=function(e){i.scope[o]=e,i.scan()}),r.watch(a,t,s)}U.component=function(E,$){var e,t,n=E.match(/^(\w+)[\-](.+)$/);t=l(t=n?(e=n[1],n[2]):(e="$global",E)),U.d[e]||(U.d[e]={}),U.d[e][t]={restrict:"E",stopBinding:!0,priority:U.priority.$component,init:function(e,i,t,n){var o={$sendEvent:function(e,t){var n=new CustomEvent(e);n.value=t,n.component=!0,i.dispatchEvent(n)}},a=n.changeDetector.new(),r=U.ChangeDetector(o),s=new T({element:i,attributes:n.attributes,changeDetector:r,parentChangeDetector:a});try{var l=$.call(r,o,i,s)||{}}catch(e){return void U.exceptionHandler(e,"Error in component <"+E+">: ",{element:i,scope:o,cd:r})}l.onStart&&r.watch("$finishBinding",function(){l.onStart(),r.scan()});var c=!1;a.watch("$destroy",function(){c=!0,r.destroy()}),r.watch("$destroy",function(){l.onDestroy&&l.onDestroy(),c||a.destroy()});for(var u=0,p=i.attributes;u<p.length;u++){if("#"===(y=p[u]).name[0]){var d=y.name.slice(1);if(d){l.api?a.setValue(d,l.api):a.setValue(d,o);break}}}function f(e,t){var n=":"+e,i=s.takeAttr(n);if(!i){if(!(i=s.takeAttr(e)))return;t="copy"}A({childCD:r,listener:t,name:e,parentName:i,parentCD:a})}if(l.props)if(Array.isArray(l.props))for(var h=0,v=l.props;h<v.length;h++){f(m=v[h],!0)}else for(var m in l.props)f(m,l.props[m]);else for(var g=0,b=i.attributes;g<b.length;g++){var y,w=(y=b[g]).name,_=y.value;if(_){var x=w.match(/^\:(.*)$/);x&&A({childCD:r,name:x[1],parentName:_,parentCD:a})}}var k=!1;if(a.watch("$onScanOnce",function(){return k=!0}),l.template&&(i.innerHTML=l.template),l.templateId){var C=document.getElementById(l.templateId);if(!C)throw"No template "+l.templateId;i.innerHTML=C.innerHTML}function S(e){k||a.digest(),U.bind(r,i,{skip:!0})}l.templateUrl?D.ajax({url:l.templateUrl,cache:!0,success:function(e){i.innerHTML=e,S(!0)},error:function(){console.error("Template is not loaded",l.templateUrl)}}):S()}}}}(),U}var t=e();t.makeInstance=e,"function"==typeof alightInitCallback?alightInitCallback(t):"function"==typeof define?define(function(){return t}):"object"==typeof module&&"object"==typeof module.exports?module.exports=t:(t.option.globalController=!0,(window.alight=t).f$.ready(t.bootstrap))}()}(jQuery);