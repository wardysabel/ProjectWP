!function(w,r,a,e){"use strict";function i(){this.isMobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},this.transitionEvent=function(){var t=a.createElement("fakeelement"),o={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var i in o)if(t.style[i]!==e)return o[i];return null},this.animationEvent=function(){var t=a.createElement("fakeelement"),o={animation:"animationend",MSAnimationEnd:"msAnimationEnd",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var i in o)if(t.style[i]!==e)return o[i];return null}}var n="vision-instance",s=0;function h(t,o){s++,this.util=new i,this.$container=null,this.config=null,this.controls={},this.imageWidth=0,this.imageHeight=0,this.layers=[],this.bodyClick=!1,this.themeClass=null,this.lightboxThemeClass=null,this.timerIdResize=null,this.timerIdScroll=null,this.elementZindex=[],this.inboxLayer=null,this.lightboxLayer=null,this.ready=!1,this._init(t,o)}h.prototype={VERSION:"1.2.0",defaults:{theme:"default",width:null,height:null,imgSrc:null,delayResize:100,layers:[],fonts:[],className:null,onPreInit:null,onLoad:null},defaultsLayer:{x:0,y:0,width:null,height:null,angle:null,url:null,urlNewWindow:!1,responsive:!1,noevents:!1,tooltip:null,popover:null,data:null,dataSelector:null,className:null},defaultsTooltip:{active:!0,placement:"top",offset:{x:0,y:0},width:null,widthFromCSS:!1,trigger:"hover",followCursor:!1,responsive:!1,interactive:!0,smart:!1,showOnInit:!1,showAnimation:null,hideAnimation:null,duration:200,data:null,dataSelector:null,className:null},defaultsPopover:{active:!0,type:"tooltip",placement:"top",offset:{x:0,y:0},responsive:!1,smart:!0,mobileType:"lightbox",trigger:"hover",showAnimation:null,hideAnimation:null,duration:300,className:null},util:null,lightbox:{layer:null,theme:null,controls:{}},_init:function(t,o){this.$container=t,this.config=o,this._create()},_create:function(){var o=this;function i(){o._buildDOM(),o._setTheme(o.config.theme),o._bind(),o._initLayers(),o._beforeReady(),o._updateSize(),o._ready()}var e=new Image;e.onload=w.proxy(function(t){o.imageWidth=e.width,o.imageHeight=e.height,setTimeout(i,300)},this),e.onerror=w.proxy(function(t){console.error('Cannot load image "'+o.config.imgSrc+'"')},this),e.src=o.config.imgSrc},_setTheme:function(t){this.$container.removeClass(this.themeClass),this.themeClass=t?"vision-theme-"+t.toLowerCase():null,this.lightboxThemeClass=t?"vision-lightbox-theme-"+t.toLowerCase():null,this.$container.addClass(this.themeClass)},_buildDOM:function(){if(this.controls.$image=w("<div></div>").addClass("vision-image").css({"background-image":"url("+this.config.imgSrc+")"}),this.controls.$stage=w("<div></div>").addClass("vision-stage"),this.controls.$layers=w("<div></div>").addClass("vision-layers"),this.controls.$tooltips=w("<div></div>").addClass("vision-tooltips"),this.controls.$popovers=w("<div></div>").addClass("vision-popovers"),this.controls.$lastLayer=w("<div></div>").addClass("vision-layer-last").attr("tabindex",1),this.controls.$inbox=w("<div></div>").addClass("vision-inbox").addClass("vision-hide").attr("tabindex",1),this.controls.$inboxInner=w("<div></div>").addClass("vision-inbox-inner"),this.controls.$inboxForm=w("<div></div>").addClass("vision-inbox-form"),this.controls.$inboxFrame=w("<div></div>").addClass("vision-inbox-frame"),this.controls.$inboxClose=w("<div></div>").addClass("vision-inbox-close"),this.controls.$inbox.append(this.controls.$inboxInner.append(this.controls.$inboxForm.append(this.controls.$inboxFrame,this.controls.$inboxClose))),this.lightbox.controls.$lightbox||(this.lightbox.controls.$lightbox=w("<div></div>").addClass("vision-lightbox").addClass("vision-hide").attr("tabindex",1),this.lightbox.controls.$lightboxInner=w("<div></div>").addClass("vision-lightbox-inner"),this.lightbox.controls.$lightboxForm=w("<div></div>").addClass("vision-lightbox-form"),this.lightbox.controls.$lightboxFrame=w("<div></div>").addClass("vision-lightbox-frame"),this.lightbox.controls.$lightboxClose=w("<div></div>").addClass("vision-lightbox-close"),this.lightbox.controls.$lightbox.append(this.lightbox.controls.$lightboxInner.append(this.lightbox.controls.$lightboxForm.append(this.lightbox.controls.$lightboxFrame,this.lightbox.controls.$lightboxClose))),w("body").append(this.lightbox.controls.$lightbox),this.lightbox.controls.$lightboxClose.on("click",w.proxy(this._onLightboxCloseClick,this)),this.lightbox.controls.$lightbox.on("keydown",w.proxy(this._onLightboxKeyboard,this))),this.controls.$stage.append(this.controls.$layers.append(this.controls.$lastLayer),this.controls.$tooltips,this.controls.$popovers),this.controls.$image.append(this.controls.$stage),this.$container.prepend(this.controls.$image,this.controls.$inbox).addClass("vision-map").addClass(this.config.className),null!=this.config.width&&this.$container.css({width:this.config.width}),null!=this.config.height&&this.$container.css({height:this.config.height}),this.config.fonts)for(var t=0;t<this.config.fonts.length;t++){var o=this.config.fonts[t],i=o.replace(new RegExp("[+]|[:]","g"),"");if(0==w("#"+i).length){var e=a.getElementsByTagName("head")[0],s=a.createElement("link");s.setAttribute("id",i),s.setAttribute("rel","stylesheet"),s.setAttribute("href","https://fonts.googleapis.com/css?family="+o),e.appendChild(s)}}},_bind:function(){w(r).on("resize",w.proxy(this._onResize,this)),w(r).on("scroll",w.proxy(this._onScroll,this)),w("body").on("click",w.proxy(this._onBodyClickTooltip,this)),this.controls.$lastLayer.on("focus",w.proxy(this._onLastLayerFocus,this)),this.controls.$inboxClose.on("click",w.proxy(this._onInboxCloseClick,this)),this.controls.$inbox.on("keydown",w.proxy(this._onInboxKeyboard,this))},_unbind:function(){w(r).off("resize",w.proxy(this._onResize,this)),w(r).off("scroll",w.proxy(this._onScroll,this)),w("body").off("click",w.proxy(this._onBodyClickTooltip,this)),this.controls.$lastLayer.off("focus",w.proxy(this._onLastLayerFocus,this)),this.controls.$inboxClose.off("click",w.proxy(this._onInboxCloseClick,this)),this.controls.$inbox.off("keydown",w.proxy(this._onInboxKeyboard,this))},_beforeReady:function(){this.$container.addClass("vision-before-ready"),this.$container.get(0).offsetHeight,this.$container.is(":hidden")&&this.$container.css("display","block");for(var t=0;t<this.layers.length;t++){var o=this.layers[t];if(!o.cfg.tooltip.widthFromCSS){var i=o.$tooltip.get(0).getBoundingClientRect(),e=o.cfg.tooltip.width?o.cfg.tooltip.width:i.width+1;o.$tooltip.css({width:e})}if(o.$tooltipPos.css({width:"auto"}),!o.cfg.popover.widthFromCSS){i=o.$popover.get(0).getBoundingClientRect(),e=o.cfg.popover.width?o.cfg.popover.width:i.width+1;o.$popover.css({width:e})}o.$popoverPos.css({width:"auto"}),(o.cfg.tooltip.showOnInit||"sticky"==o.cfg.tooltip.trigger)&&this._showTooltip(o),o.cfg.popover.showOnInit&&this._showPopover(o)}this.$container.removeClass("vision-before-ready")},_ready:function(){if(this.config.onLoad){var t=null;if("string"==typeof this.config.onLoad)try{t=new Function(this.config.onLoad)}catch(t){console.error("Can not compile onLoad function: "+t.message)}else"function"==typeof this.config.onLoad&&(t=this.config.onLoad);t&&t.call(this)}this.$container.addClass("vision-ready"),this.ready=!0,this.$container.trigger("vision:ready",[this])},_destroy:function(){this._unbind(),this.controls.$image.remove(),this.controls.$inbox.remove(),this.$container.removeClass("vision-ready").removeClass("vision-map").removeClass(this.config.className),this._setTheme(null),0==--s&&(this.lightbox.controls.$lightbox.remove(),w("body").removeClass("vision-lightbox-active"))},_updateSize:function(){var t=this.imageHeight/this.imageWidth,o=this.$container.width(),i=null==this.config.height?t*o:this.$container.height();null==this.config.height&&this.controls.$image.css({height:i});for(var e=o/this.imageWidth,s=i/this.imageHeight,l=0;l<this.layers.length;l++){var r=this.layers[l];r.cfg.responsive&&r.$layerZoom.css({transform:"scale("+e+","+s+")"}),r.cfg.tooltip.responsive&&r.$tooltipZoom.css({transform:"scale("+e+","+s+")"}),r.tooltipVisible&&this._showTooltip(r),r.cfg.popover.responsive&&"tooltip"==r.cfg.popover.type&&(r.$popoverZoom.css({transform:"scale("+e+","+s+")"}),r.popoverVisible&&this._showPopover(r))}},_updatePlacement:function(){for(var t=0;t<this.layers.length;t++){var o=this.layers[t];o.tooltipVisible&&this._showTooltip(o),o.popoverVisible&&this._showPopover(o)}},_initLayers:function(){if(this.config.layers)for(var t=0;t<this.config.layers.length;t++){var o=this.config.layers[t];this._addLayer(o)}},_addLayer:function(t){t.tooltip=w.extend(!0,{},this.defaultsTooltip,t.tooltip),t.popover=w.extend(!0,{},this.defaultsPopover,t.popover);t=w.extend(!0,{},this.defaultsLayer,t);var o=w("<div></div>").addClass("vision-layer-wrap").addClass(t.className),i=w("<div></div>").addClass("vision-layer-pos").css({top:t.y+"%",left:t.x+"%"}),e=w("<div></div>").addClass("vision-layer-offset"),s=w("<div></div>").addClass("vision-layer-zoom"),l=w("<div></div>").addClass("vision-layer");if(t.noevents&&l.addClass("vision-noevents"),t.url&&l.addClass("vision-url"),"focus"!=t.tooltip.trigger&&"focus"!=t.popover.trigger||l.attr("tabindex",1),t.autoWidth||null==t.width||l.css({width:t.width}),t.autoHeight||null==t.height||l.css({height:t.height}),null!=t.angle&&l.css({transform:"rotate("+t.angle+"deg)"}),t.data)l.html(t.data);else if(t.dataSelector){(C=w(t.dataSelector)).length&&(C.detach(),l.append(C))}else{(C=this.$container.find(".vision-store").find(".vision-lr-"+(this.layers.length+1))).length&&(C.detach(),l.append(C))}o.append(i.append(s.append(e.append(l)))),this.controls.$layers.append(o),this.controls.$lastLayer.detach(),this.controls.$layers.append(this.controls.$lastLayer);var r=w("<div></div>").addClass("vision-tooltip-wrap").addClass("vision-hide").addClass(t.tooltip.className),a=w("<div></div>").addClass("vision-tooltip-pos").css({top:t.y+"%",left:t.x+"%"}),n=w("<div></div>").addClass("vision-tooltip-zoom"),h=w("<div></div>").addClass("vision-tooltip-offset"),p=w("<div></div>").addClass("vision-tooltip-form"),c=w("<div></div>").addClass("vision-tooltip-arrow"),d=w("<div></div>").addClass("vision-tooltip-frame"),g=w("<div></div>").addClass("vision-tooltip");if((t.tooltip.showAnimation||t.tooltip.hideAnimation)&&t.tooltip.duration&&p.css({"animation-duration":t.tooltip.duration+"ms","-webkit-animation-duration":t.tooltip.duration+"ms"}),t.tooltip.data)g.html(t.tooltip.data);else if(t.tooltip.dataSelector){(C=w(t.tooltip.dataSelector)).length&&(C.detach(),g.append(C))}else{(C=this.$container.find(".vision-store").find(".vision-tt-"+(this.layers.length+1))).length&&(C.detach(),g.append(C))}r.append(a.append(n.append(h.append(p.append(d.append(g),c))))),this.controls.$tooltips.append(r);var f=w("<div></div>").addClass("vision-popover-wrap").addClass("vision-hide").addClass(t.popover.className),v=w("<div></div>").addClass("vision-popover-pos").css({top:t.y+"%",left:t.x+"%"}),b=w("<div></div>").addClass("vision-popover-zoom"),m=w("<div></div>").addClass("vision-popover-offset"),y=w("<div></div>").addClass("vision-popover-form"),u=w("<div></div>").addClass("vision-popover-arrow"),x=w("<div></div>").addClass("vision-popover-frame"),$=w("<div></div>").addClass("vision-popover");switch(this.util.isMobile()?t.popover.mobileType:t.popover.type){case"tooltip":$.addClass("vision-popover-type-tooltip");break;case"inbox":$.addClass("vision-popover-type-inbox");break;case"lightbox":$.addClass("vision-popover-type-lightbox")}if(t.popover.data)$.html(t.popover.data);else if(t.popover.dataSelector){(C=w(t.popover.dataSelector)).length&&(C.detach(),$.append(C))}else{var C;(C=this.$container.find(".vision-store").find(".vision-pp-"+(this.layers.length+1))).length&&(C.detach(),$.append(C))}f.append(v.append(b.append(m.append(y.append(x.append($),u))))),this.controls.$popovers.append(f);t={$layerWrap:o,$layerPos:i,$layerZoom:s,$layerOffset:e,$layer:l,$tooltipWrap:r,$tooltipPos:a,$tooltipZoom:n,$tooltipOffset:h,$tooltipForm:p,$tooltipFrame:d,$tooltip:g,tooltipVisible:!1,$popoverWrap:f,$popoverPos:v,$popoverZoom:b,$popoverOffset:m,$popoverForm:y,$popoverFrame:x,$popover:$,popoverVisible:!1,cfg:t};this._bindLayer(t),this.layers.push(t),this._updateBodyClick()},_bindLayer:function(t){switch(t.cfg.url&&t.$layer.on("click",w.proxy(this._onLayerClickLink,this,t)),t.cfg.tooltip.trigger){case"hover":t.$layer.on("mouseenter",w.proxy(this._onLayerEnterTooltip,this,t)),t.$layer.on("mouseleave",w.proxy(this._onLayerLeaveTooltip,this,t)),this.util.isMobile()&&(t.$layer.on("focus",w.proxy(this._onLayerFocusTooltip,this,t)),t.$layer.on("blur",w.proxy(this._onLayerBlurTooltip,this,t)));break;case"focus":t.$layer.on("focus",w.proxy(this._onLayerFocusTooltip,this,t)),t.$layer.on("blur",w.proxy(this._onLayerBlurTooltip,this,t));break;case"click":case"clickbody":t.$layer.on("click",w.proxy(this._onLayerClickTooltip,this,t))}switch(t.cfg.popover.trigger){case"hover":t.$layer.on("mouseenter",w.proxy(this._onLayerEnterPopover,this,t)),this.util.isMobile()&&t.$layer.on("focus",w.proxy(this._onLayerFocusPopover,this,t));break;case"focus":t.$layer.on("focus",w.proxy(this._onLayerFocusPopover,this,t));break;case"click":t.$layer.on("click",w.proxy(this._onLayerClickPopover,this,t));break;case"dblclick":t.$layer.on("dblclick",w.proxy(this._onLayerClickPopover,this,t))}},_deleteLayer:function(t){if(0<=t&&t<this.layers.length){var o=this.layers[t];return o.$layerWrap.remove(),o.$tooltipWrap.remove(),this.layers.splice(t,1),!0}return!1},_updateBodyClick:function(){this.bodyClick=!1;for(var t=0;t<this.layers.length;t++){var o=this.layers[t];if("clickbody"==o.cfg.tooltip.trigger||"focus"==o.cfg.tooltip.trigger){this.bodyClick=!0;break}}},_getViewportOffset:function(t){var o=w(r),i=o.scrollLeft(),e=o.scrollTop(),s=t.get(0).getBoundingClientRect(),l=t.offset();return{left:l.left-i,top:l.top-e,bottom:Math.max(a.documentElement.clientHeight,r.innerHeight||0)-l.top+e-s.height,right:Math.max(a.documentElement.clientWidth,r.innerWidth||0)-l.left+i-s.width}},_showTooltip:function(t,o,i,e){if(t.cfg.tooltip.active){var s=this.imageHeight/this.imageWidth,l=this.$container.width(),r=null==this.config.height?s*l:this.$container.height(),a=l/this.imageWidth,n=r/this.imageHeight,h="hover"==t.cfg.tooltip.trigger&&t.cfg.tooltip.followCursor?5:t.cfg.height*(t.cfg.responsive&&!t.cfg.tooltip.responsive?n:1)/2,p="hover"==t.cfg.tooltip.trigger&&t.cfg.tooltip.followCursor?5:t.cfg.width*(t.cfg.responsive&&!t.cfg.tooltip.responsive?a:1)/2,c=t.cfg.tooltip.offset.y,d=t.cfg.tooltip.offset.x;switch(o=o||!1,i=i||t.cfg.tooltip.placement,e=e||!1,t.$tooltipWrap.removeClass(t.$tooltipWrap.data("placement")),t.$tooltipWrap.addClass("vision-tooltip-"+i).data("placement","vision-tooltip-"+i),i){case"top-left":h=-h,p=-p,c=-c,d=d;break;case"top":h=-h,c=-c,d=p=0;break;case"top-right":h=-h,p=p,c=-c,d=-d;break;case"right-top":h=-h,p=p,c=c,d=d;break;case"right":p=p,c=h=0,d=d;break;case"right-bottom":h=h,p=p,c=-c,d=d;break;case"bottom-right":h=h,p=p,c=c,d=-d;break;case"bottom":h=h,c=c,d=p=0;break;case"bottom-left":h=h,p=-p,c=c,d=d;break;case"left-bottom":h=h,p=-p,c=-c,d=-d;break;case"left":p=-p,c=h=0,d=-d;break;case"left-top":h=-h,p=-p,c=c,d=-d;break;default:h=p=t.cfg.tooltip.followCursor?5:0}if(t.$tooltipOffset.css({"margin-top":h,"margin-left":p}),t.cfg.tooltip.followCursor&&"hover"==t.cfg.tooltip.trigger&&(t.$layer.on("mousemove",w.proxy(this._onLayerMouseMoveTooltip,this,t)),t.$tooltipWrap.addClass("vision-noevents-hard")),t.$tooltipPos.css({top:t.cfg.y+"%",left:t.cfg.x+"%","margin-top":c,"margin-left":d}),!t.tooltipVisible){t.tooltipVisible=!0,t.$tooltipWrap.addClass("vision-show").removeClass("vision-hide");var g=0<this.elementZindex.length?Math.max.apply(null,this.elementZindex)+1:1;this.elementZindex.push(g),t.$tooltipPos.css("z-index",g),o&&t.cfg.tooltip.showAnimation&&(t.$tooltipForm.removeClass(t.cfg.tooltip.showAnimation).removeClass(t.cfg.tooltip.hideAnimation),t.$tooltipForm.addClass(t.cfg.tooltip.showAnimation),t.$tooltipForm.one(this.util.animationEvent(),w.proxy(function(t,o){w(o.target).removeClass(t.cfg.tooltip.showAnimation)},this,t)))}if(!e&&t.cfg.tooltip.smart){var f=this._getViewportOffset(t.$layerOffset),v=this._getViewportOffset(t.$tooltipOffset),b=t.$layerOffset.get(0).getBoundingClientRect(),m=t.$tooltipOffset.get(0).getBoundingClientRect();switch(i){case"top-left":v.right<0&&(i=0<f.left+b.width-m.width?i.replace("-left","-right"):i.replace("-left","")),v.top<0&&(i=i.replace("top","bottom"));break;case"top":v.right<0&&0<f.left+b.width-m.width&&(i+="-right"),v.left<0&&0<f.right+b.width-m.width&&(i+="-left"),v.top<0&&(i=i.replace("top","bottom"));break;case"top-right":v.left<0&&(i=0<f.right+b.width-m.width?i.replace("-right","-left"):i.replace("-right","")),v.top<0&&(i=i.replace("top","bottom"));break;case"right-top":v.top<0&&b.height>m.height&&(i=i.replace("-top","-bottom")),v.right<0&&(i=i.replace("right","left"));break;case"right":v.top<0&&(b.height>m.height?i+="-bottom":i+="-top"),v.bottom<0&&(b.height>m.height?i+="-top":i+="-bottom"),v.right<0&&(i=i.replace("right","left"));break;case"right-bottom":v.bottom<0&&b.height>m.height&&(i=i.replace("-bottom","-top")),v.right<0&&(i=i.replace("right","left"));break;case"bottom-right":v.left<0&&(i=0<f.right+b.width-m.width?i.replace("-right","-left"):i.replace("-right","")),v.bottom<0&&(i=i.replace("bottom","top"));break;case"bottom":v.right<0&&0<f.left+b.width-m.width&&(i+="-right"),v.left<0&&0<f.right+b.width-m.width&&(i+="-left"),v.top<0&&(i=i.replace("bottom","top"));break;case"bottom-left":v.right<0&&(i=0<f.left+b.width-m.width?i.replace("-left","-right"):i.replace("-left","")),v.bottom<0&&(i=i.replace("bottom","top"));break;case"left-bottom":v.bottom<0&&b.height>m.height&&(i=i.replace("-bottom","-top")),v.left<0&&(i=i.replace("left","right"));break;case"left":v.top<0&&(b.height>m.height?i+="-bottom":i+="-top"),v.bottom<0&&(b.height>m.height?i+="-top":i+="-bottom"),v.left<0&&(i=i.replace("left","right"));break;case"left-top":v.top<0&&b.height>m.height&&(i=i.replace("-top","-bottom")),v.left<0&&(i=i.replace("left","right"))}this._showTooltip(t,!1,i,!0)}}},_hideTooltip:function(t){t.$layer.off("mousemove",w.proxy(this._onLayerMouseMoveTooltip,t,this)),t.$tooltipWrap.removeClass("vision-noevents-hard"),t.tooltipVisible&&(t.tooltipVisible=!1,t.cfg.tooltip.hideAnimation?(t.$tooltipForm.removeClass(t.cfg.tooltip.showAnimation).removeClass(t.cfg.tooltip.hideAnimation),t.$tooltipForm.addClass(t.cfg.tooltip.hideAnimation),t.$tooltipForm.one(this.util.animationEvent(),w.proxy(function(t,o){w(o.target).removeClass(t.cfg.tooltip.hideAnimation),t.tooltipVisible||this.__hideTooltip(t)},this,t))):this.__hideTooltip(t))},__hideTooltip:function(t){t.$tooltipWrap.addClass("vision-hide").removeClass("vision-show");var o=this.elementZindex.indexOf(parseInt(t.$tooltipPos.css("z-index"),10));-1<o&&this.elementZindex.splice(o,1),t.$tooltipPos.css("z-index",""),t.$tooltip.detach(),t.$tooltip.get(0).offsetHeight,t.$tooltip.appendTo(t.$tooltipFrame)},_onLayerClickLink:function(t,o){t.cfg.url&&r.open(t.cfg.url,t.cfg.urlNewWindow?"_blank":"_self")},_onLayerEnterTooltip:function(t,o){this._showTooltip(t,!0)},_onLayerLeaveTooltip:function(t,o){var i=o.relatedTarget||o.toElement;t.cfg.tooltip.interactive&&(0!==t.$tooltipWrap.has(i).length||t.$tooltipWrap.is(i))||t.$layer.is(i)?t.$tooltipWrap.one("mouseleave",w.proxy(this._onLayerLeaveTooltip,this,t)):this._hideTooltip(t)},_onLayerMouseMoveTooltip:function(t,o){var i=this.controls.$stage.get(0).getBoundingClientRect(),e=(o.clientY-i.y)/i.height*100,s=(o.clientX-i.x)/i.width*100;t.$tooltipPos.css({top:e+"%",left:s+"%"})},_onLayerFocusTooltip:function(t,o){this._showTooltip(t,!0)},_onLayerBlurTooltip:function(t,o){this._hideTooltip(t)},_onLayerClickTooltip:function(t,o){t.tooltipVisible?this._hideTooltip(t):this._showTooltip(t,!0)},_onBodyClickTooltip:function(t){if(this.bodyClick)for(var o=t.relatedTarget||t.toElement,i=0;i<this.layers.length;i++){var e=this.layers[i];0<e.$layerWrap.has(o).length||e.$layerWrap.is(o)||e.tooltipVisible&&("clickbody"==e.cfg.tooltip.trigger||"focus"==e.cfg.tooltip.trigger&&!e.$layer.is(":focus"))&&(!e.tooltipVisible||e.cfg.tooltip.interactive&&(0!==e.$tooltipWrap.has(o).length||e.$tooltipWrap.is(o))||this._hideTooltip(e))}},_onLastLayerFocus:function(t){this.layers.length&&this.layers[0].$layer.focus()},_showPopover:function(t,o,i,e){if(t&&t.cfg.popover.active){var s=this.util.isMobile()?t.cfg.popover.mobileType:t.cfg.popover.type;if("tooltip"==s){var l=this.imageHeight/this.imageWidth,r=this.$container.width(),a=null==this.config.height?l*r:this.$container.height(),n=r/this.imageWidth,h=a/this.imageHeight,p=t.cfg.height*(t.cfg.responsive&&!t.cfg.popover.responsive?h:1)/2,c=t.cfg.width*(t.cfg.responsive&&!t.cfg.popover.responsive?n:1)/2,d=t.cfg.popover.offset.y,g=t.cfg.popover.offset.x;switch(o=o||!1,i=i||t.cfg.popover.placement,e=e||!1,t.$popoverWrap.removeClass(t.$popoverWrap.data("placement")),t.$popoverWrap.addClass("vision-popover-"+i).data("placement","vision-popover-"+i),i){case"top-left":p=-p,c=-c,d=-d,g=g;break;case"top":p=-p,d=-d,g=c=0;break;case"top-right":p=-p,c=c,d=-d,g=-g;break;case"right-top":p=-p,c=c,d=d,g=g;break;case"right":c=c,d=p=0,g=g;break;case"right-bottom":p=p,c=c,d=-d,g=g;break;case"bottom-right":p=p,c=c,d=d,g=-g;break;case"bottom":p=p,d=d,g=c=0;break;case"bottom-left":p=p,c=-c,d=d,g=g;break;case"left-bottom":p=p,c=-c,d=-d,g=-g;break;case"left":c=-c,d=p=0,g=-g;break;case"left-top":p=-p,c=-c,d=d,g=-g;break;default:p=c=0}if(t.$popoverOffset.css({"margin-top":p,"margin-left":c}),t.$popoverPos.css({top:t.cfg.y+"%",left:t.cfg.x+"%","margin-top":d,"margin-left":g}),!t.popoverVisible){t.popoverVisible=!0,t.$popoverWrap.addClass("vision-show").removeClass("vision-hide");var f=0<this.elementZindex.length?Math.max.apply(null,this.elementZindex)+1:1;this.elementZindex.push(f),t.$popoverPos.css("z-index",f)}if(!e&&t.cfg.popover.smart){var v=this._getViewportOffset(t.$layerOffset),b=this._getViewportOffset(t.$popoverOffset),m=t.$layerOffset.get(0).getBoundingClientRect(),y=t.$popoverOffset.get(0).getBoundingClientRect();switch(i){case"top-left":b.right<0&&(i=0<v.left+m.width-y.width?i.replace("-left","-right"):i.replace("-left","")),b.top<0&&(i=i.replace("top","bottom"));break;case"top":b.right<0&&0<v.left+m.width-y.width&&(i+="-right"),b.left<0&&0<v.right+m.width-y.width&&(i+="-left"),b.top<0&&(i=i.replace("top","bottom"));break;case"top-right":b.left<0&&(i=0<v.right+m.width-y.width?i.replace("-right","-left"):i.replace("-right","")),b.top<0&&(i=i.replace("top","bottom"));break;case"right-top":b.top<0&&m.height>y.height&&(i=i.replace("-top","-bottom")),b.right<0&&(i=i.replace("right","left"));break;case"right":b.top<0&&(m.height>y.height?i+="-bottom":i+="-top"),b.bottom<0&&(m.height>y.height?i+="-top":i+="-bottom"),b.right<0&&(i=i.replace("right","left"));break;case"right-bottom":b.bottom<0&&m.height>y.height&&(i=i.replace("-bottom","-top")),b.right<0&&(i=i.replace("right","left"));break;case"bottom-right":b.left<0&&(i=0<v.right+m.width-y.width?i.replace("-right","-left"):i.replace("-right","")),b.bottom<0&&(i=i.replace("bottom","top"));break;case"bottom":b.right<0&&0<v.left+m.width-y.width&&(i+="-right"),b.left<0&&0<v.right+m.width-y.width&&(i+="-left"),b.top<0&&(i=i.replace("bottom","top"));break;case"bottom-left":b.right<0&&(i=0<v.left+m.width-y.width?i.replace("-left","-right"):i.replace("-left","")),b.bottom<0&&(i=i.replace("bottom","top"));break;case"left-bottom":b.bottom<0&&m.height>y.height&&(i=i.replace("-bottom","-top")),b.left<0&&(i=i.replace("left","right"));break;case"left":b.top<0&&(m.height>y.height?i+="-bottom":i+="-top"),b.bottom<0&&(m.height>y.height?i+="-top":i+="-bottom"),b.left<0&&(i=i.replace("left","right"));break;case"left-top":b.top<0&&m.height>y.height&&(i=i.replace("-top","-bottom")),b.left<0&&(i=i.replace("left","right"))}this._showPopover(t,!1,i,!0)}}else"inbox"==s?this._showPopoverInbox(t):"lightbox"==s&&this._showPopoverLightbox(t)}},_hidePopover:function(t){if(t)switch(this.util.isMobile()?t.cfg.popover.mobileType:t.cfg.popover.type){case"tooltip":this.__hidePopover(t);break;case"inbox":this._hidePopoverInbox();break;case"lightbox":this._hidePopoverLightbox()}},__hidePopover:function(t){if(t.popoverVisible){t.popoverVisible=!1,t.$popoverWrap.addClass("vision-hide").removeClass("vision-show");var o=this.elementZindex.indexOf(parseInt(t.$popoverPos.css("z-index"),10));-1<o&&this.elementZindex.splice(o,1),t.$popoverPos.css("z-index",""),t.$popover.detach(),t.$popover.get(0).offsetHeight,t.$popover.appendTo(t.$popoverFrame)}},_onLayerEnterPopover:function(t,o){this._showPopover(t,!0)},_onLayerFocusPopover:function(t,o){this._showPopover(t,!0)},_onLayerClickPopover:function(t,o){t.popoverVisible?this._hidePopover(t):this._showPopover(t,!0)},_onInboxCloseClick:function(t){this._hidePopoverInbox()},_onInboxKeyboard:function(t){27!==t.keyCode||this._hidePopoverInbox()},_onLightboxCloseClick:function(t){this._hidePopoverLightbox()},_onLightboxKeyboard:function(t){27!==t.keyCode||this._hidePopoverLightbox()},_showPopoverInbox:function(t){this.inboxLayer&&this._hidePopover(this.inboxLayer),this.inboxLayer=t,this.inboxLayer.$popover.detach();var o=this.inboxLayer.$popover.attr("style");this.inboxLayer.$popover.data("style",o),this.inboxLayer.$popover.attr("style",""),this.controls.$inbox.addClass(this.inboxLayer.cfg.popover.className),this.controls.$inboxFrame.append(t.$popover),this.controls.$inboxFrame.get(0).offsetHeight,this.controls.$inboxFrame.height()>this.controls.$inboxForm.height()&&this.controls.$inboxForm.addClass("vision-inbox-form-overflow"),this.controls.$inbox.addClass("vision-show").removeClass("vision-hide").focus()},_hidePopoverInbox:function(){if(this.inboxLayer){this.inboxLayer.$popover.detach();var t=this.inboxLayer.$popover.data("style");this.inboxLayer.$popover.attr("style",t),this.inboxLayer.$popover.data("style",""),this.controls.$inbox.removeClass(this.inboxLayer.cfg.popover.className),this.inboxLayer.$popoverFrame.append(this.inboxLayer.$popover),this.inboxLayer=null}this.controls.$inbox.addClass("vision-hide").removeClass("vision-show"),this.controls.$inboxForm.removeClass("vision-inbox-form-overflow")},_showPopoverLightbox:function(t){this._hidePopoverLightbox(),this.lightbox.layer=t,this.lightbox.theme=this.lightboxThemeClass,this.lightbox.layer.$popover.detach();var o=this.lightbox.layer.$popover.attr("style");this.lightbox.layer.$popover.data("style",o),this.lightbox.layer.$popover.attr("style",""),this.lightbox.controls.$lightbox.addClass(this.lightbox.layer.cfg.popover.className).addClass(this.lightbox.theme),this.lightbox.controls.$lightboxFrame.append(this.lightbox.layer.$popover),this.lightbox.controls.$lightboxFrame.get(0).offsetHeight,this.lightbox.controls.$lightboxFrame.height()>this.lightbox.controls.$lightboxForm.height()&&this.lightbox.controls.$lightboxForm.addClass("vision-lightbox-form-overflow"),this.lightbox.controls.$lightbox.addClass("vision-show").removeClass("vision-hide").focus(),w("body").addClass("vision-lightbox-active")},_hidePopoverLightbox:function(){if(w("body").removeClass("vision-lightbox-active"),this.lightbox.controls.$lightbox.removeClass(this.lightbox.theme).addClass("vision-hide").removeClass("vision-show"),this.lightbox.controls.$lightboxForm.removeClass("vision-lightbox-form-overflow"),this.lightbox.theme=null,this.lightbox.layer){this.lightbox.layer.$popover.detach();var t=this.lightbox.layer.$popover.data("style");this.lightbox.layer.$popover.attr("style",t),this.lightbox.layer.$popover.data("style",""),this.lightbox.controls.$lightbox.removeClass(this.lightbox.layer.cfg.popover.className),this.lightbox.layer.$popoverFrame.append(this.lightbox.layer.$popover),this.lightbox.layer=null}},_onResize:function(){if(this.ready){var t=this;clearTimeout(this.timerIdResize),this.timerIdResize=setTimeout(function(){t._updateSize()},this.config.delayResize)}},_onScroll:function(){if(this.ready){var t=this;clearTimeout(this.timerIdScroll),this.timerIdScroll=setTimeout(function(){t._updatePlacement()},100)}},setTheme:function(t){this._setTheme(t)},addLayer:function(t){this._addLayer(t)},deleteLayer:function(t){return this._deleteLayer(t)},showPopover:function(t){this._showPopover(t)},hidePopover:function(t){this._hidePopover(t)}},w.fn.vision=function(r,t){if("instance"!=r)return this.each(function(){var i=w(this),e=i.data(n),t=i.data("json-src"),s=i.data("img-src"),l=w.isPlainObject(r)?r:t?null:{};if("destroy"==r)return e?(i.removeData(n),void e._destroy()):void console.error('Calling "destroy" method on not initialized instance is forbidden');function o(){var t=w.extend(!0,{},h.prototype.defaults,l);if(null==t.imgSrc&&s&&(t.imgSrc=s),t.onPreInit){var o=null;if("string"==typeof t.onPreInit)try{o=new Function("config",t.onPreInit)}catch(t){console.error('Can not compile "onPreInit" function: '+t.message)}else"function"==typeof t.onPreInit&&(o=t.onPreInit);o&&o.call(this,t)}e=new h(i,t),i.data(n,e)}e&&(i.removeData(n),e._destroy(),e=null),null==l?w.ajax({url:t,type:"GET",dataType:"json"}).done(function(t){l=w.isPlainObject(t)?t:{}}).fail(function(t){l={}}).always(function(){o()}):o()});var o=w(this).data(n);return o||void console.error('Calling "instance" method on not initialized instance is forbidden')},w(".vision-map").vision()}(jQuery,window,document);